var Robroy=function(t){var e={};function r(a){if(e[a])return e[a].exports;var o=e[a]={i:a,l:!1,exports:{}};return t[a].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(a,o,function(e){return t[e]}.bind(null,o));return a},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return p}));class a{static addAttributes(t,e){window.ROBROY.args.attributes[t]&&Object.keys(window.ROBROY.args.attributes[t]).forEach(r=>{e.setAttribute(r,window.ROBROY.args.attributes[t][r])})}static callback(t){window.ROBROY.args.callbacks[t]&&window.ROBROY.args.callbacks[t]()}static debounce(t,e,r,...a){var o;return function(){var i=this,n=r&&!o;clearTimeout(o),o=setTimeout((function(){o=null,r||t.apply(i,a)}),e),n&&t.apply(i,a)}}static isLoggedIn(){return window.localStorage.getItem("authenticated")}static propertyExists(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}class o{static show(t,e){(e=e||{}).closeButtonText=e.closeButtonText||"OK",e.closeButtonClass=e.closeButtonClass||"";var r="robroy-modal-"+(new Date).getTime(),i=document.createElement("div");i.setAttribute("id",r),i.setAttribute("class","robroy-modal"),i.setAttribute("role","alert");var n=document.createElement("div");n.setAttribute("class","robroy-modal-box"),i.appendChild(n);var s,l=document.createElement("p");if(l.setAttribute("class","robroy-modal-text"),e.html?l.innerHTML=t:l.innerText=t,n.appendChild(l),!e.hideClose||e.showCancel){var d=document.createElement("p");if(d.setAttribute("class","robroy-modal-options"),n.appendChild(d),!e.hideClose){(s=document.createElement("button")).setAttribute("id","robroy-modal-close"),s.setAttribute("type","button"),s.setAttribute("class",("robroy-button "+e.closeButtonClass).trim()),s.setAttribute("data-id",r),s.innerText=e.closeButtonText,s.addEventListener("click",t=>{o.hide(t),a.propertyExists(e,"callback")&&e.callback(t)}),d.appendChild(s),document.addEventListener("keydown",o.keydownListener,!1)}if(e.showCancel){var u=document.createElement("button");u.setAttribute("id","robroy-modal-cancel"),u.setAttribute("type","button"),u.setAttribute("class","robroy-button robroy-button--secondary"),u.setAttribute("data-id",r),u.innerText="Cancel",u.addEventListener("click",this.hide),d.appendChild(u)}}document.body.appendChild(i),s&&(window.ROBROY.activeElement=document.activeElement,s.focus())}static keydownListener(t){27===t.keyCode&&(o.hide({target:document.getElementById("robroy-modal-close")}),document.removeEventListener("keydown",o.keydownListener))}static hide(t){var e=document.getElementById(t.target.getAttribute("data-id"));e.parentNode.removeChild(e),window.ROBROY.activeElement&&(window.ROBROY.activeElement.focus(),window.ROBROY.activeElement=null)}}class i{static show(){var t=document.querySelector(".robroy-spinner");t||((t=document.createElement("div")).setAttribute("class","robroy-spinner"),document.body.appendChild(t)),t.style.display=""}static hide(){document.querySelector(".robroy-spinner").style.display="none"}}class n{static request(t){(t=t||{}).method=t.method||"GET",i.show();var e=new XMLHttpRequest;e.onreadystatechange=()=>{if(e.readyState===XMLHttpRequest.DONE){i.hide();var r=e.responseText;if(r||!(e.status<200||e.status>299)){if(r&&!t.noParse){try{r=JSON.parse(r)}catch(t){return void o.show("Error: The sever returned a non-JSON response.")}if(r.errors){var a=r.errors.map(t=>t.title);return void o.show("Error: "+a)}}t.callback(r,e.status)}else o.show("Error: The sever returned a "+e.status+" error.")}},e.open(t.method,t.url,!0),e.send(t.formData)}}class s{static show(){var t="robroy-empty",e=document.getElementById(t);e||((e=document.createElement("p")).setAttribute("id",t),e.innerText="No images found."),window.ROBROY.container.appendChild(e),window.ROBROY.list.style.display="none"}static hide(){var t=document.getElementById("robroy-empty");t&&t.parentNode.removeChild(t),window.ROBROY.list.style.display=""}static getFigures(){return document.querySelectorAll("#robroy-list > figure")}static hasFigures(){return s.getFigures().length>0}}class l{static element(t){var e=document.createElement("figure");e.setAttribute("class","robroy-figure"),e.setAttribute("data-path",t.id),a.addAttributes("figure",e);var r=document.createElement("a");r.setAttribute("class","robroy-link"),r.setAttribute("href",t.attributes.url),r.style.backgroundImage='url("'+t.attributes.thumbnail+'")',a.addAttributes("a",r),e.appendChild(r);var o=document.createElement("img");return o.setAttribute("class","robroy-img"),o.setAttribute("src",t.attributes.thumbnail),o.setAttribute("height",t.attributes.thumbnailHeight),o.setAttribute("width",t.attributes.thumbnailWidth),a.addAttributes("img",o),r.appendChild(o),a.isLoggedIn()&&l.addEditControls(e),e}static addEditControls(t){var e=document.createElement("button");e.setAttribute("class","robroy-admin robroy-button robroy-button--danger"),e.setAttribute("type","button"),e.innerText="Delete",e.addEventListener("click",l.delete),t.appendChild(e)}static addUploadControl(){var t=document.createElement("form");t.setAttribute("action",window.ROBROY.args.apiPath+"?type=images"),t.setAttribute("class","robroy-admin"),t.setAttribute("enctype","multipart/form-data"),t.setAttribute("id","robroy-upload-form"),t.setAttribute("method","post"),t.addEventListener("submit",l.upload);var e=document.createElement("div");e.setAttribute("id","robroy-upload-container"),t.appendChild(e);var r=document.createElement("input");r.setAttribute("accept","image/*"),r.setAttribute("id","robroy-upload-input"),r.setAttribute("name","upload[]"),r.setAttribute("multiple","multiple"),r.setAttribute("title","Select images to upload"),r.setAttribute("type","file"),r.addEventListener("change",l.onChange),e.appendChild(r);var a=document.createElement("div");a.setAttribute("id","robroy-upload-text"),a.innerText="Drag images or click here to upload.",e.appendChild(a);var o=document.createElement("button");o.setAttribute("class","robroy-button"),o.setAttribute("id","robroy-upload-button"),o.setAttribute("type","submit"),o.innerText="Upload",t.appendChild(o),window.ROBROY.container.prepend(t)}static delete(t){var e=t.target.parentNode.getAttribute("data-path");o.show('Are you sure you want to delete "'+e+'"?',{closeButtonText:"Delete",closeButtonClass:"robroy-button--danger",showCancel:!0,callback:()=>{l.deleteCallback(e)}})}static deleteCallback(t){n.request({method:"DELETE",url:window.ROBROY.args.apiPath+"?type=images&path="+t,callback:()=>{var e,r=document.querySelector('[data-path="'+t+'"]');r.nextSibling&&(e=[...r.nextSibling.children].find(t=>"A"===t.tagName)),r.parentNode.removeChild(r),s.hasFigures()?(window.ROBROY.grid.resizeAllItems(),e&&e.focus()):s.show(),a.callback("afterDeleteImage")}})}static onChange(t){var e=[...t.target.files].map(t=>t.name);document.getElementById("robroy-upload-text").innerText=e.join(", "),document.getElementById("robroy-upload-button").style.display="flex"}static upload(t){if(t.preventDefault(),document.getElementById("robroy-upload-input").files.length<=0)o.show("Error: No files selected.");else{var e=document.getElementById("robroy-upload-form"),r=new FormData(e);n.request({method:e.getAttribute("method"),url:e.getAttribute("action"),formData:r,callback:t=>{l.uploadCallback(t)}})}}static uploadCallback(t){s.hide(),l.prependImages(t.data),window.ROBROY.grid.resizeAllItems(),document.getElementById("robroy-upload-input").value="",document.getElementById("robroy-upload-text").innerText="Drag files or click here to upload.",document.getElementById("robroy-upload-button").style.display="",a.callback("afterUploadImage")}static prependImages(t){t.forEach(t=>{window.ROBROY.list.prepend(l.element(t))})}}class d{static init(){window.ROBROY.auth&&(window.ROBROY.auth.addEventListener("click",()=>{d.authenticate()}),d.handleAuthentication())}static authenticate(){a.isLoggedIn()?d.logout():d.login()}static logout(){if(window.navigator.userAgent.indexOf("Safari")>-1)return window.localStorage.clear(),void d.handleLogout();var t=[window.location.protocol,"//log:out@",window.location.host,window.ROBROY.args.apiPath+"?type=sessions"].join("");n.request({method:"DELETE",url:t,noParse:!0,callback:()=>{window.localStorage.clear(),d.handleLogout()}})}static login(){n.request({method:"POST",url:window.ROBROY.args.apiPath+"?type=sessions",noParse:!0,callback:(t,e)=>{204===e?(window.localStorage.setItem("authenticated",!0),this.handleLogin()):o.show("Error: Invalid username or password.")}})}static handleAuthentication(){a.isLoggedIn()?d.handleLogin():d.handleLogout()}static handleLogin(){window.ROBROY.auth.innerText="Log Out",s.getFigures().forEach(t=>{l.addEditControls(t)}),l.addUploadControl()}static handleLogout(){window.ROBROY.auth.innerText="Log In",document.querySelectorAll(".robroy-admin").forEach(t=>{t.parentNode.removeChild(t)})}}class u{constructor(){this.calculate(),window.addEventListener("resize",a.debounce(()=>{this.calculate(),this.resizeAllItems()},100))}calculate(){var t=window.getComputedStyle(window.ROBROY.list);this.gridRowHeight=parseInt(t.getPropertyValue("grid-auto-rows"),10),this.gridRowGap=parseInt(t.getPropertyValue("grid-row-gap"),10)}checkResizeItem(t){var e=t.querySelector("img");if(e.complete)this.resizeItem(t);else var r=setInterval(()=>{e.complete&&(clearInterval(r),this.resizeItem(t))},100)}resizeItem(t){var e=t.querySelector("a");e.style.position="";var r=e.getBoundingClientRect().height,a=Math.ceil((r+this.gridRowGap)/(this.gridRowHeight+this.gridRowGap));e.style.position="absolute",t.style.gridRowEnd="span "+a}resizeAllItems(){[...document.getElementsByClassName("robroy-figure")].forEach(t=>{this.checkResizeItem(t)})}}class c{static init(){c.loadImages(()=>{c.onScroll()}),window.addEventListener("scroll",a.debounce(()=>{c.onScroll()},100))}static loadImages(t){window.ROBROY.args.isLoading=!0;var e=[window.ROBROY.args.apiPath,"?type=images&page[number]="+ ++window.ROBROY.args.pageNumber,"&page[size]="+window.ROBROY.args.pageSize].join("");n.request({url:e,callback:e=>{c.appendImages(e.data),window.ROBROY.grid.resizeAllItems(),window.ROBROY.args.isLoading=!1,e.meta.number>=e.meta.total_pages&&(window.ROBROY.args.allPagesLoaded=!0),e.meta.total_pages<=0&&s.show(),t&&t(),a.callback("afterLoadImage")}})}static onScroll(){if(!window.ROBROY.args.allPagesLoaded&&!window.ROBROY.args.isLoading){var t=document.querySelector("#robroy-list > figure:last-of-type");if(t){var e=t.offsetTop;window.pageYOffset+window.innerHeight>e&&c.loadImages()}}}static appendImages(t){t.forEach(t=>{window.ROBROY.list.appendChild(l.element(t))})}}class p{constructor(t){(t=t||{}).allPagesLoaded=!1,t.apiPath=t.apiPath||"/api.php",t.attributes=t.attributes||{},t.callbacks=t.callbacks||{},t.isLoading=!1,t.pageNumber=0,t.pageSize=t.pageSize||8,t.selector=t.selector||"#robroy",this.args=t;var e=document.querySelector(t.selector);if(e){var r=document.createElement("div");r.setAttribute("id","robroy-list"),e.appendChild(r),this.auth=document.querySelector('[data-action="authenticate"]'),this.container=e,this.list=r}}static init(t){if(!a.propertyExists(window,"ROBROY")){if(window.ROBROY=new p(t),!window.ROBROY.list)return;d.init(),c.init(),window.ROBROY.grid=new u}return window.ROBROY}}}]);