var Robroy;Robroy=(()=>{"use strict";var t={575:(t,e,a)=>{a.r(e),a.d(e,{default:()=>p});class r{static addAttributes(t,e){window.ROBROY.args.attributes[t]&&Object.keys(window.ROBROY.args.attributes[t]).forEach((a=>{e.setAttribute(a,window.ROBROY.args.attributes[t][a])}))}static callback(t){window.ROBROY.args.callbacks[t]&&window.ROBROY.args.callbacks[t]()}static debounce(t,e,a,...r){var o;return function(){var i=this,n=a&&!o;clearTimeout(o),o=setTimeout((function(){o=null,a||t.apply(i,r)}),e),n&&t.apply(i,r)}}static isLoggedIn(){return window.localStorage.getItem("authenticated")}static propertyExists(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}class o{static show(t,e){(e=e||{}).closeButtonText=e.closeButtonText||"OK",e.closeButtonClass=e.closeButtonClass||"";var a="robroy-modal-"+(new Date).getTime(),i=document.createElement("div");i.setAttribute("id",a),i.setAttribute("class","robroy-modal"),i.setAttribute("role","alert");var n=document.createElement("div");n.setAttribute("class","robroy-modal-box"),i.appendChild(n);var s,l=document.createElement("p");if(l.setAttribute("class","robroy-modal-text"),e.html?l.innerHTML=t:l.innerText=t,n.appendChild(l),!e.hideClose||e.showCancel){var d=document.createElement("p");if(d.setAttribute("class","robroy-modal-options"),n.appendChild(d),e.hideClose||((s=document.createElement("button")).setAttribute("id","robroy-modal-close"),s.setAttribute("type","button"),s.setAttribute("class",("robroy-button "+e.closeButtonClass).trim()),s.setAttribute("data-id",a),s.innerText=e.closeButtonText,s.addEventListener("click",(t=>{o.hide(t),r.propertyExists(e,"callback")&&e.callback(t)})),d.appendChild(s),document.addEventListener("keydown",o.keydownListener,!1)),e.showCancel){var c=document.createElement("button");c.setAttribute("id","robroy-modal-cancel"),c.setAttribute("type","button"),c.setAttribute("class","robroy-button robroy-button--secondary"),c.setAttribute("data-id",a),c.innerText="Cancel",c.addEventListener("click",this.hide),d.appendChild(c)}}document.body.appendChild(i),s&&(window.ROBROY.activeElement=document.activeElement,s.focus())}static keydownListener(t){27===t.keyCode&&(o.hide({target:document.getElementById("robroy-modal-close")}),document.removeEventListener("keydown",o.keydownListener))}static hide(t){var e=document.getElementById(t.target.getAttribute("data-id"));e.parentNode.removeChild(e),window.ROBROY.activeElement&&(window.ROBROY.activeElement.focus(),window.ROBROY.activeElement=null)}}class i{static show(){var t=document.querySelector(".robroy-spinner");t||((t=document.createElement("div")).setAttribute("class","robroy-spinner"),document.body.appendChild(t)),t.style.display=""}static hide(){document.querySelector(".robroy-spinner").style.display="none"}}class n{static request(t){(t=t||{}).method=t.method||"GET",i.show();var e=new XMLHttpRequest;e.onreadystatechange=()=>{if(e.readyState===XMLHttpRequest.DONE){i.hide();var a=e.responseText;if(a||!(e.status<200||e.status>299)){if(a&&!t.noParse){try{a=JSON.parse(a)}catch(t){return void o.show("Error: The sever returned a non-JSON response.")}if(a.errors){var r=a.errors.map((t=>t.title));return void o.show("Error: "+r)}}t.callback(a,e.status)}else o.show("Error: The sever returned a "+e.status+" error.")}},e.open(t.method,t.url,!0),e.send(t.formData)}}class s{static show(){var t="robroy-empty",e=document.getElementById(t);e||((e=document.createElement("p")).setAttribute("id",t),e.innerText="No images found."),window.ROBROY.container.appendChild(e),window.ROBROY.list.style.display="none"}static hide(){var t=document.getElementById("robroy-empty");t&&t.parentNode.removeChild(t),window.ROBROY.list.style.display=""}static getFigures(){return document.querySelectorAll("#robroy-list > figure")}static hasFigures(){return s.getFigures().length>0}}class l{static element(t){var e=document.createElement("figure");e.setAttribute("class","robroy-figure"),e.setAttribute("data-path",t.id),r.addAttributes("figure",e);var a=document.createElement("a");a.setAttribute("class","robroy-link"),a.setAttribute("href",t.attributes.url),a.style.backgroundImage='url("'+t.attributes.thumbnail+'")',r.addAttributes("a",a),e.appendChild(a);var o=document.createElement("img");return o.setAttribute("class","robroy-img"),o.setAttribute("src",t.attributes.thumbnail),o.setAttribute("height",t.attributes.thumbnailHeight),o.setAttribute("width",t.attributes.thumbnailWidth),r.addAttributes("img",o),a.appendChild(o),r.isLoggedIn()&&l.addEditControls(e),e}static addEditControls(t){var e=document.createElement("button");e.setAttribute("class","robroy-admin robroy-button robroy-button--danger"),e.setAttribute("type","button"),e.innerText="Delete",e.addEventListener("click",l.delete),t.appendChild(e)}static addUploadControl(){var t=document.createElement("form");t.setAttribute("action",window.ROBROY.args.apiPath+"?type=images"),t.setAttribute("class","robroy-admin"),t.setAttribute("enctype","multipart/form-data"),t.setAttribute("id","robroy-upload-form"),t.setAttribute("method","post"),t.addEventListener("submit",l.upload);var e=document.createElement("div");e.setAttribute("id","robroy-upload-container"),t.appendChild(e);var a=document.createElement("input");a.setAttribute("accept","image/*"),a.setAttribute("id","robroy-upload-input"),a.setAttribute("name","upload[]"),a.setAttribute("multiple","multiple"),a.setAttribute("title","Select images to upload"),a.setAttribute("type","file"),a.addEventListener("change",l.onChange),e.appendChild(a);var r=document.createElement("div");r.setAttribute("id","robroy-upload-text"),r.innerText="Drag images or click here to upload.",e.appendChild(r);var o=document.createElement("button");o.setAttribute("class","robroy-button"),o.setAttribute("id","robroy-upload-button"),o.setAttribute("type","submit"),o.innerText="Upload",t.appendChild(o),window.ROBROY.container.prepend(t)}static delete(t){var e=t.target.parentNode.getAttribute("data-path");o.show('Are you sure you want to delete "'+e+'"?',{closeButtonText:"Delete",closeButtonClass:"robroy-button--danger",showCancel:!0,callback:()=>{l.deleteCallback(e)}})}static deleteCallback(t){n.request({method:"DELETE",url:window.ROBROY.args.apiPath+"?type=images&path="+t,callback:()=>{var e,a=document.querySelector('[data-path="'+t+'"]');a.nextSibling&&(e=[...a.nextSibling.children].find((t=>"A"===t.tagName))),a.parentNode.removeChild(a),s.hasFigures()?(window.ROBROY.grid.resizeAllItems(),e&&e.focus()):s.show(),r.callback("afterDeleteImage")}})}static onChange(t){var e=[...t.target.files].map((t=>t.name));document.getElementById("robroy-upload-text").innerText=e.join(", "),document.getElementById("robroy-upload-button").style.display="flex"}static upload(t){if(t.preventDefault(),document.getElementById("robroy-upload-input").files.length<=0)o.show("Error: No files selected.");else{var e=document.getElementById("robroy-upload-form"),a=new FormData(e);n.request({method:e.getAttribute("method"),url:e.getAttribute("action"),formData:a,callback:t=>{l.uploadCallback(t)}})}}static uploadCallback(t){s.hide(),l.prependImages(t.data),window.ROBROY.grid.resizeAllItems(),document.getElementById("robroy-upload-input").value="",document.getElementById("robroy-upload-text").innerText="Drag files or click here to upload.",document.getElementById("robroy-upload-button").style.display="",r.callback("afterUploadImage")}static prependImages(t){t.forEach((t=>{window.ROBROY.list.prepend(l.element(t))}))}}class d{static init(){window.ROBROY.auth&&(window.ROBROY.auth.addEventListener("click",(()=>{d.authenticate()})),d.handleAuthentication())}static authenticate(){r.isLoggedIn()?d.logout():d.login()}static logout(){if(window.navigator.userAgent.indexOf("Safari")>-1)return window.localStorage.clear(),void d.handleLogout();var t=[window.location.protocol,"//log:out@",window.location.host,window.ROBROY.args.apiPath+"?type=sessions"].join("");n.request({method:"DELETE",url:t,noParse:!0,callback:()=>{window.localStorage.clear(),d.handleLogout()}})}static login(){n.request({method:"POST",url:window.ROBROY.args.apiPath+"?type=sessions",noParse:!0,callback:(t,e)=>{204===e?(window.localStorage.setItem("authenticated",!0),this.handleLogin()):o.show("Error: Invalid username or password.")}})}static handleAuthentication(){r.isLoggedIn()?d.handleLogin():d.handleLogout()}static handleLogin(){window.ROBROY.auth.innerText="Log Out",s.getFigures().forEach((t=>{l.addEditControls(t)})),l.addUploadControl()}static handleLogout(){window.ROBROY.auth.innerText="Log In",document.querySelectorAll(".robroy-admin").forEach((t=>{t.parentNode.removeChild(t)}))}}class c{constructor(){this.calculate(),window.addEventListener("resize",r.debounce((()=>{this.calculate(),this.resizeAllItems()}),100))}calculate(){var t=window.getComputedStyle(window.ROBROY.list);this.gridRowHeight=parseInt(t.getPropertyValue("grid-auto-rows"),10),this.gridRowGap=parseInt(t.getPropertyValue("grid-row-gap"),10)}checkResizeItem(t){var e=t.querySelector("img");if(e.complete)this.resizeItem(t);else var a=setInterval((()=>{e.complete&&(clearInterval(a),this.resizeItem(t))}),100)}resizeItem(t){var e=t.querySelector("a");e.style.position="";var a=e.getBoundingClientRect().height,r=Math.ceil((a+this.gridRowGap)/(this.gridRowHeight+this.gridRowGap));e.style.position="absolute",t.style.gridRowEnd="span "+r}resizeAllItems(){[...document.getElementsByClassName("robroy-figure")].forEach((t=>{this.checkResizeItem(t)}))}}class u{static init(){u.loadImages((()=>{u.onScroll()})),window.addEventListener("scroll",r.debounce((()=>{u.onScroll()}),100))}static loadImages(t){window.ROBROY.args.isLoading=!0;var e=[window.ROBROY.args.apiPath,"?type=images&page[number]="+ ++window.ROBROY.args.pageNumber,"&page[size]="+window.ROBROY.args.pageSize].join("");n.request({url:e,callback:e=>{u.appendImages(e.data),window.ROBROY.grid.resizeAllItems(),window.ROBROY.args.isLoading=!1,e.meta.number>=e.meta.total_pages&&(window.ROBROY.args.allPagesLoaded=!0),e.meta.total_pages<=0&&s.show(),t&&t(),r.callback("afterLoadImage")}})}static onScroll(){if(!window.ROBROY.args.allPagesLoaded&&!window.ROBROY.args.isLoading){var t=document.querySelector("#robroy-list > figure:last-of-type");if(t){var e=t.offsetTop;window.pageYOffset+window.innerHeight>e&&u.loadImages()}}}static appendImages(t){t.forEach((t=>{window.ROBROY.list.appendChild(l.element(t))}))}}class p{constructor(t){(t=t||{}).allPagesLoaded=!1,t.apiPath=t.apiPath||"/api.php",t.attributes=t.attributes||{},t.callbacks=t.callbacks||{},t.isLoading=!1,t.pageNumber=0,t.pageSize=t.pageSize||8,t.selector=t.selector||"#robroy",this.args=t;var e=document.querySelector(t.selector);if(e){var a=document.createElement("div");a.setAttribute("id","robroy-list"),e.appendChild(a),this.auth=document.querySelector('[data-action="authenticate"]'),this.container=e,this.list=a}}static init(t){if(!r.propertyExists(window,"ROBROY")){if(window.ROBROY=new p(t),!window.ROBROY.list)return null;d.init(),u.init(),window.ROBROY.grid=new c}return window.ROBROY}}}},e={};function a(r){if(e[r])return e[r].exports;var o=e[r]={exports:{}};return t[r](o,o.exports,a),o.exports}return a.d=(t,e)=>{for(var r in e)a.o(e,r)&&!a.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a(575)})();