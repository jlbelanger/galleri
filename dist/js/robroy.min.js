var Robroy;(()=>{"use strict";var e={d:(t,r)=>{for(var o in r)e.o(r,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:r[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{e.r(t),e.d(t,{default:()=>m});class r{static addAttributes(e,t){window.ROBROY.args.attributes[e]&&Object.keys(window.ROBROY.args.attributes[e]).forEach((r=>{t.setAttribute(r,window.ROBROY.args.attributes[e][r])}))}static addError(e,t){e.classList.add("robroy-has-error");const r=document.createElement("span");r.setAttribute("class","robroy-error"),r.setAttribute("id",`robroy-error-${e.getAttribute("id")}`),r.innerText=t,e.after(r)}static callback(e){window.ROBROY.args.callbacks[e]&&window.ROBROY.args.callbacks[e]()}static debounce(e,t,r,...o){let a;return function(){const n=this,i=r&&!a;clearTimeout(a),a=setTimeout((function(){a=null,r||e.apply(n,o)}),t),i&&e.apply(n,o)}}static isLoggedIn(){return window.localStorage.getItem("authenticated")}static propertyExists(e,t){return Object.prototype.hasOwnProperty.call(e,t)}static setMetaTitle(e){const t=document.querySelector("title");t.innerText=e+window.ROBROY.args.metaTitleSeparator+t.innerText}static setNumImages(){const e=1===window.ROBROY.currentNumImages?window.ROBROY.args.singularImageText:window.ROBROY.args.pluralImageText;window.ROBROY.elements.$numImages.innerText=`${window.ROBROY.currentNumImages.toLocaleString()} ${e}`}}class o{constructor(){this.calculate(),window.addEventListener("resize",r.debounce((()=>{this.calculate(),this.resizeAllItems()}),100))}calculate(){const e=window.getComputedStyle(window.ROBROY.elements.$imageList);this.gridRowHeight=parseInt(e.getPropertyValue("grid-auto-rows"),10),this.gridRowGap=parseInt(e.getPropertyValue("grid-row-gap"),10)}checkResizeItem(e){const t=e.querySelector("img");if(t.complete)this.resizeItem(e);else{const r=setInterval((()=>{t.complete&&(clearInterval(r),this.resizeItem(e))}),100)}}resizeItem(e){const t=e.querySelector("a");t.style.position="";const r=t.getBoundingClientRect().height,o=Math.ceil((r+this.gridRowGap)/(this.gridRowHeight+this.gridRowGap));t.style.position="absolute",e.style.gridRowEnd=`span ${o}`}resizeAllItems(){[...document.getElementsByClassName("robroy-figure")].forEach((e=>{this.checkResizeItem(e)}))}}class a{static show(e,t){(t=t||{}).closeButtonText=t.closeButtonText||"OK",t.closeButtonClass=t.closeButtonClass||"";const o=`robroy-modal-${(new Date).getTime()}`,n=document.createElement("div");n.setAttribute("id",o),n.setAttribute("class","robroy-modal"),n.setAttribute("role","alert");const i=document.createElement("div");i.setAttribute("class","robroy-modal-box"),n.appendChild(i);const d=document.createElement("p");let s;if(d.setAttribute("class","robroy-modal-text"),t.append?d.appendChild(e):d.innerText=e,i.appendChild(d),!t.hideClose||t.showCancel){const e=document.createElement("p");if(e.setAttribute("class","robroy-modal-options"),i.appendChild(e),!t.hideClose){const n=e=>{r.propertyExists(t,"callback")?t.callback(e):a.hide(e)};s=document.createElement("button"),s.setAttribute("id","robroy-modal-close"),s.setAttribute("type","button"),s.setAttribute("class",`robroy-button ${t.closeButtonClass}`.trim()),s.setAttribute("data-id",o),s.setAttribute("data-robroy-modal-close",""),t.closeButtonAttributes&&Object.keys(t.closeButtonAttributes).forEach((e=>{s.setAttribute(e,t.closeButtonAttributes[e])})),s.innerText=t.closeButtonText,s.addEventListener("click",n),e.appendChild(s),document.addEventListener("keydown",a.keydownListener,!1)}if(t.showCancel){const t=document.createElement("button");t.setAttribute("id","robroy-modal-cancel"),t.setAttribute("type","button"),t.setAttribute("class","robroy-button robroy-button--secondary"),t.setAttribute("data-id",o),t.innerText="Cancel",t.addEventListener("click",this.hide),e.appendChild(t)}}document.body.appendChild(n),s&&(window.ROBROY.activeElement=document.activeElement,s.focus())}static keydownListener(e){"Escape"===e.key&&(a.hide(),document.removeEventListener("keydown",a.keydownListener))}static hide(e){let t;t=e&&e.target?e.target:document.querySelector("[data-robroy-modal-close]");const r=document.getElementById(t.getAttribute("data-id"));r.parentNode.removeChild(r),window.ROBROY.activeElement&&(window.ROBROY.activeElement.focus(),window.ROBROY.activeElement=null)}}class n{static show(){let e=document.querySelector(".robroy-spinner");e||(e=document.createElement("div"),e.setAttribute("class","robroy-spinner"),document.body.appendChild(e)),e.style.display=""}static hide(){document.querySelector(".robroy-spinner").style.display="none"}}class i{static request(e){(e=e||{}).method=e.method||"GET",n.show();const t=new XMLHttpRequest;t.onreadystatechange=()=>{if(t.readyState!==XMLHttpRequest.DONE)return;n.hide();let r=t.responseText;if(r||!(t.status<200||t.status>299)){if(r&&!e.noParse){try{r=JSON.parse(r)}catch(o){return void(e.errorCallback?e.errorCallback(r,t.status):a.show(`Error: The server returned a non-JSON response. (${e.url})`))}if(r.errors){const e=r.errors.map((e=>e.title));return void a.show(`Error: ${e}`)}}e.callback(r,t.status)}else e.errorCallback?e.errorCallback(r,t.status):a.show(`Error: The server returned a ${t.status} error.`)},t.open(e.method,e.url,!0),e.json?(t.setRequestHeader("Content-Type","application/json"),t.send(e.json)):t.send(e.formData)}}class d{static isEmpty(){const e=window.getComputedStyle(window.ROBROY.elements.$imageList),t=window.getComputedStyle(window.ROBROY.elements.$folderList);return"none"===e.display&&"none"===t.display}static getImages(){return document.querySelectorAll("#robroy-images > figure")}static getFolders(){return document.querySelectorAll("#robroy-folders > li")}static hasImages(){return d.getImages().length>0}static hasFolders(){return d.getFolders().length>0}}class s{static element(e){const t=document.createElement("li");t.setAttribute("class","robroy-folder"),t.setAttribute("data-path",e.id),t.setAttribute("data-name",e.attributes.name);const r=document.createElement("a");return r.setAttribute("class","robroy-folder-link"),r.setAttribute("href",`?folder=${e.id}`),r.innerText=e.attributes.name,t.appendChild(r),t}static addEditControls(){const e=document.createElement("div");e.setAttribute("class","robroy-admin robroy-form robroy-form-container");const t=s.form("Edit","edit","put",s.edit);t.setAttribute("class","robroy-form robroy-form--folder"),e.appendChild(t);const r=document.createElement("button");r.setAttribute("class","robroy-button robroy-button--danger robroy-form--delete"),r.setAttribute("id","robroy-delete-folder"),r.setAttribute("type","button"),r.innerText="Delete Folder",d.isEmpty()||(r.style.display="none"),r.addEventListener("click",s.delete),e.appendChild(r),window.ROBROY.elements.$container.prepend(e)}static addCreateControl(){const e=s.form("Create","create","post",s.create);e.setAttribute("class","robroy-admin robroy-form robroy-form--folder robroy-form-container"),window.ROBROY.elements.$container.prepend(e)}static form(e,t,r,o){const a=document.createElement("form");a.setAttribute("action",`${window.ROBROY.args.apiPath}?type=folders`),a.setAttribute("id",`robroy-${t}-folder-form`),a.setAttribute("method",r),a.addEventListener("submit",o);const n=document.createElement("h2");n.setAttribute("class","robroy-heading"),n.innerText=`${e} Folder`,a.appendChild(n);const i=document.createElement("label");i.setAttribute("class","robroy-label"),i.setAttribute("for",`robroy-${t}-folder-name`),i.innerText="Name:",a.appendChild(i);const d=document.createElement("input");d.setAttribute("class","robroy-input"),d.setAttribute("id",`robroy-${t}-folder-name`),d.setAttribute("name","name"),d.setAttribute("type","text"),a.appendChild(d),"edit"===t&&d.setAttribute("value",window.ROBROY.currentFolder.attributes.name);const l=document.createElement("label");l.setAttribute("class","robroy-label"),l.setAttribute("for",`robroy-${t}-folder-parent`),l.innerText="Parent:",a.appendChild(l);const c=document.createElement("select");let u;c.setAttribute("class","robroy-select"),c.setAttribute("id",`robroy-${t}-folder-parent`),c.setAttribute("name","parent"),a.appendChild(c),"create"===t?u=window.ROBROY.currentFolderId:"edit"===t&&(u=s.getParentId(window.ROBROY.currentFolder.id)),s.addFolderOptions(c,u);const m=document.createElement("button");return m.setAttribute("class","robroy-button"),m.setAttribute("id",`robroy-${t}-submit`),m.setAttribute("type","submit"),m.innerText=e,a.appendChild(m),a}static addFolderOptions(e,t){e.innerText="";let r,o=document.createElement("option");o.setAttribute("value",""),e.appendChild(o),Object.keys(window.ROBROY.folders).sort().forEach((function(a){r=window.ROBROY.folders[a],o=document.createElement("option"),o.setAttribute("value",r.id),o.innerText=s.getFullName(window.ROBROY.folders[r.id]),r.id===t&&o.setAttribute("selected","selected"),e.appendChild(o)}))}static delete(){const e=window.ROBROY.currentFolderId;a.show(`Are you sure you want to delete the folder "${e}"?`,{closeButtonText:"Delete",closeButtonClass:"robroy-button--danger",showCancel:!0,callback:()=>{s.deleteCallback(e),a.hide()}})}static deleteCallback(e){i.request({method:"DELETE",url:`${window.ROBROY.args.apiPath}?type=folders&id=${e}`,callback:()=>{r.callback("afterDeleteFolder");const e=s.getParentId(window.ROBROY.currentFolder.id);window.location=window.location.href.replace(`?folder=${window.ROBROY.currentFolderId}`,e?`?folder=${e}`:"")}})}static create(e){if(e.preventDefault(),!document.getElementById("robroy-create-folder-name").value)return void a.show("Error: Please enter a name.");const t=document.getElementById("robroy-create-folder-form"),r=new FormData(t);let o={};r.forEach(((e,t)=>{o[t]=e})),o=JSON.stringify(o),i.request({method:t.getAttribute("method"),url:t.getAttribute("action"),json:o,callback:e=>{s.createCallback(e)}})}static createCallback(e){const t=s.getParentId(e.data.id);if(t&&t===window.ROBROY.currentFolderId||!t&&!window.ROBROY.currentFolderId){s.addToList(e.data);const t=document.getElementById("robroy-delete-folder");t&&(t.style.display="none")}document.getElementById("robroy-create-folder-name").value="",window.ROBROY.folders[e.data.id]=e.data;const o=document.getElementById("robroy-create-folder-parent");s.addFolderOptions(o,o.value);const a=document.getElementById("robroy-edit-folder-parent");a&&s.addFolderOptions(a,s.getParentId(window.ROBROY.currentFolder.id)),r.callback("afterCreateFolder")}static edit(e){e.preventDefault();const t=document.getElementById("robroy-edit-folder-name");if(!t.value)return void a.show("Error: Please enter a name.");const r=document.getElementById("robroy-edit-folder-parent"),o=t.value!==window.ROBROY.currentFolder.attributes.name;let n;const d=s.getParentId(window.ROBROY.currentFolder.id);if(n=d?r.value!==d:!!r.value,!o&&!n)return void a.show("Nothing to update.");const l=document.getElementById("robroy-edit-folder-form"),c=new FormData(l);let u={};c.forEach(((e,t)=>{u[t]=e})),u=JSON.stringify(u),i.request({method:l.getAttribute("method"),url:`${l.getAttribute("action")}&id=${window.ROBROY.currentFolderId}`,json:u,callback:e=>{s.editCallback(e)}})}static editCallback(e){r.callback("afterEditFolder"),window.location=window.location.href.replace(`?folder=${window.ROBROY.currentFolderId}`,`?folder=${e.data.id}`)}static addToList(e){let t;const r=window.ROBROY.elements.$folderList.children,o=r.length;let a;for(t=0;t<o&&r[t].getAttribute("data-path")<e.id;t++)a=r[t];a?a.after(s.element(e)):window.ROBROY.elements.$folderList.prepend(s.element(e))}static getFullName(e){const t=[e.attributes.name];let r=s.getParentId(e.id);for(;r&&window.ROBROY.folders[r];)e=window.ROBROY.folders[r],t.push(e.attributes.name),r=s.getParentId(e.id);return t.reverse().join(" > ")}static getParentId(e){const t=e.lastIndexOf("/");return-1===t?"":e.substr(0,t)}}class l{static element(e){const t=document.createElement("figure");t.setAttribute("class","robroy-figure"),t.setAttribute("data-path",e.id),r.addAttributes("figure",t);const o=document.createElement("a");o.setAttribute("class","robroy-link"),o.setAttribute("href",e.attributes.url),o.style.backgroundImage=`url("${e.attributes.thumbnail}")`,r.addAttributes("a",o),t.appendChild(o);const a=document.createElement("img");return a.setAttribute("class","robroy-img"),a.setAttribute("src",e.attributes.thumbnail),a.setAttribute("height",e.attributes.thumbnailHeight),a.setAttribute("width",e.attributes.thumbnailWidth),r.addAttributes("img",a),o.appendChild(a),r.isLoggedIn()&&l.addEditControls(t),t}static addEditControls(e){const t=document.createElement("div");t.setAttribute("class","robroy-button-container"),e.appendChild(t);const r=document.createElement("button");r.setAttribute("class","robroy-admin robroy-button"),r.setAttribute("href","button"),r.innerText="View",r.addEventListener("click",l.view),t.appendChild(r);const o=document.createElement("button");o.setAttribute("class","robroy-admin robroy-button robroy-button--danger"),o.setAttribute("type","button"),o.innerText="Delete",o.addEventListener("click",l.delete),t.appendChild(o);const a=document.createElement("button");a.setAttribute("class","robroy-admin robroy-button robroy-button--secondary"),a.setAttribute("type","button"),a.innerText="Edit",a.addEventListener("click",l.edit),t.appendChild(a),e.querySelector(".robroy-link").style.pointerEvents="none"}static addCreateControl(){const e=document.createElement("form");e.setAttribute("action",`${window.ROBROY.args.apiPath}?type=images`),e.setAttribute("class","robroy-admin robroy-form robroy-form--image robroy-form-container"),e.setAttribute("enctype","multipart/form-data"),e.setAttribute("id","robroy-create-image-form"),e.setAttribute("method","post"),e.addEventListener("submit",l.create);const t=document.createElement("div");t.setAttribute("id","robroy-create-image-container"),e.appendChild(t);const r=document.createElement("input");r.setAttribute("accept","image/*"),r.setAttribute("id","robroy-create-image-input"),r.setAttribute("name","upload[]"),r.setAttribute("multiple","multiple"),r.setAttribute("title","Select images to upload"),r.setAttribute("type","file"),r.addEventListener("change",l.onChange),t.appendChild(r);const o=document.createElement("div");o.setAttribute("id","robroy-create-image-text"),o.innerText="Drag images or click here to upload.",t.appendChild(o);const a=document.createElement("button");a.setAttribute("class","robroy-button"),a.setAttribute("id","robroy-create-image-button"),a.setAttribute("type","submit"),a.innerText="Upload",e.appendChild(a);const n=document.createElement("input");n.setAttribute("name","folder"),n.setAttribute("value",window.ROBROY.currentFolderId),n.setAttribute("type","hidden"),e.appendChild(n),window.ROBROY.elements.$container.prepend(e)}static delete(e){const t=e.target.closest("[data-path]").getAttribute("data-path");a.show(`Are you sure you want to delete "${t}"?`,{closeButtonText:"Delete",closeButtonClass:"robroy-button--danger",showCancel:!0,callback:()=>{l.deleteCallback(t),a.hide()}})}static deleteCallback(e){i.request({method:"DELETE",url:`${window.ROBROY.args.apiPath}?type=images&path=${e}`,callback:()=>{l.removeImageFromList(e),r.callback("afterDeleteImage")}})}static removeImageFromList(e){const t=document.querySelector(`[data-path="${e}"]`);let o;if(t.nextSibling&&(o=[...t.nextSibling.children].find((e=>"A"===e.tagName))),t.parentNode.removeChild(t),window.ROBROY.currentNumImages-=1,r.setNumImages(),d.hasImages())window.ROBROY.grid.resizeAllItems(),o&&o.focus();else if(!d.hasFolders()){const e=document.getElementById("robroy-delete-folder");e&&(e.style.display="")}}static onChange(e){const t=[...e.target.files].map((e=>e.name));document.getElementById("robroy-create-image-text").innerText=t.join(", "),document.getElementById("robroy-create-image-button").style.display="flex"}static create(e){if(e.preventDefault(),document.getElementById("robroy-create-image-input").files.length<=0)return void a.show("Error: No files selected.");const t=document.getElementById("robroy-create-image-form"),r=new FormData(t);i.request({method:t.getAttribute("method"),url:t.getAttribute("action"),formData:r,callback:e=>{l.createCallback(e)}})}static createCallback(e){l.prependItems(e.data),window.ROBROY.grid.resizeAllItems(),e.data.forEach((e=>{window.ROBROY.currentImages[e.id]=e})),window.ROBROY.currentNumImages+=e.data.length,r.setNumImages(),document.getElementById("robroy-create-image-input").value="",document.getElementById("robroy-create-image-text").innerText="Drag files or click here to upload.",document.getElementById("robroy-create-image-button").style.display="";const t=document.getElementById("robroy-delete-folder");t&&(t.style.display="none"),r.callback("afterCreateImage")}static edit(e){const t=e.target.closest("[data-path]").getAttribute("data-path");window.ROBROY.currentImage=window.ROBROY.currentImages[t];const r=document.createElement("form");r.setAttribute("action",`${window.ROBROY.args.apiPath}?type=images`),r.setAttribute("id","robroy-edit-image-form"),r.setAttribute("method","PUT"),r.addEventListener("submit",l.editCallback);const o=document.createElement("h2");o.setAttribute("class","robroy-heading"),o.innerText="Edit Image",r.appendChild(o);const n=document.createElement("div");n.setAttribute("class","robroy-fields"),r.appendChild(n);const i=document.createElement("label");i.setAttribute("class","robroy-label"),i.setAttribute("for","robroy-edit-image-filename"),i.innerText="Filename:",n.appendChild(i);const d=document.createElement("input");d.setAttribute("class","robroy-input"),d.setAttribute("id","robroy-edit-image-filename"),d.setAttribute("name","filename"),d.setAttribute("type","text"),d.setAttribute("value",window.ROBROY.currentImage.attributes.filename),n.appendChild(d);const c=document.createElement("label");c.setAttribute("class","robroy-label"),c.setAttribute("for","robroy-edit-image-folder"),c.innerText="Folder:",n.appendChild(c);const u=document.createElement("select");u.setAttribute("class","robroy-select"),u.setAttribute("id","robroy-edit-image-folder"),u.setAttribute("name","folder"),n.appendChild(u),s.addFolderOptions(u,window.ROBROY.currentImage.attributes.folder),a.show(r,{append:!0,callback:l.submitEditFormCallback,closeButtonAttributes:{id:"robroy-edit-image-submit",form:"robroy-edit-image-form",type:"submit"},closeButtonText:"Save",showCancel:!0})}static submitEditFormCallback(e){e.preventDefault(),document.querySelectorAll("#robroy-edit-image-form .robroy-has-error").forEach((e=>{e.classList.remove("robroy-has-error")})),document.querySelectorAll("#robroy-edit-image-form .robroy-error").forEach((e=>{e.remove()}));const t=document.getElementById("robroy-edit-image-filename");if(!t.value)return void r.addError(t,"Error: Please enter a filename.");const o=document.getElementById("robroy-edit-image-folder"),n=t.value!==window.ROBROY.currentImage.attributes.filename,d=o.value!==window.ROBROY.currentImage.attributes.folder;if(!n&&!d)return void a.hide(e);const s=document.getElementById("robroy-edit-image-form"),c=new FormData(s);let u={};c.forEach(((e,t)=>{u[t]=e})),u=JSON.stringify(u),i.request({method:s.getAttribute("method"),url:`${s.getAttribute("action")}&id=${window.ROBROY.currentImage.id}`,json:u,callback:t=>{d?l.removeImageFromList(window.ROBROY.currentImage.id):n&&l.updateImage(window.ROBROY.currentImage.id,t.data),delete window.ROBROY.currentImages[window.ROBROY.currentImage.id],window.ROBROY.currentImages[t.data.id]=t.data,window.ROBROY.currentImage=null,a.hide(e),r.callback("afterEditImage")}})}static updateImage(e,t){const r=document.querySelector(`[data-path="${e}"]`);r.setAttribute("data-path",t.id),r.querySelector(".robroy-link").setAttribute("href",t.attributes.url)}static prependItems(e){e.forEach((e=>{window.ROBROY.elements.$imageList.prepend(l.element(e))}))}static view(e){e.target.closest("[data-path]").querySelector(".robroy-link").click()}}class c{static init(){window.ROBROY.auth&&(window.ROBROY.auth.addEventListener("click",(()=>{c.authenticate()})),c.handleAuthentication())}static authenticate(){r.isLoggedIn()?c.logout():c.login()}static logout(){if(window.navigator.userAgent.indexOf("Safari")>-1)return window.localStorage.clear(),void c.handleLogout();const e=[window.location.protocol,"//log:out@",window.location.host,`${window.ROBROY.args.apiPath}?type=sessions`].join("");i.request({method:"DELETE",url:e,noParse:!0,callback:()=>{window.localStorage.clear(),c.handleLogout()}})}static login(){i.request({method:"POST",url:`${window.ROBROY.args.apiPath}?type=sessions`,noParse:!0,callback:(e,t)=>{204===t?(window.localStorage.setItem("authenticated",!0),this.handleLogin()):a.show("Error: Invalid username or password.")}})}static handleAuthentication(){r.isLoggedIn()?c.handleLogin():c.handleLogout()}static handleLogin(){window.ROBROY.auth.innerText="Log Out",d.getImages().forEach((e=>{l.addEditControls(e)})),l.addCreateControl(),s.addCreateControl(),window.ROBROY.currentFolderId&&s.addEditControls();let e=document.getElementById("robroy-create-folder-parent");e&&s.addFolderOptions(e,window.ROBROY.currentFolderId),e=document.getElementById("robroy-edit-folder-parent"),e&&s.addFolderOptions(e,s.getParentId(window.ROBROY.currentFolder.id))}static handleLogout(){window.ROBROY.auth.innerText="Log In";let e=document.querySelectorAll(".robroy-admin");e.forEach((e=>{e.parentNode.removeChild(e)})),e=document.querySelectorAll(".robroy-link"),e.forEach((e=>{e.style.pointerEvents=""}))}}class u{static init(){u.loadCurrentFolder()}static loadCurrentFolder(){if(window.ROBROY.args.showAllImages)return c.init(),u.loadImages((()=>{u.onScroll()})),void window.addEventListener("scroll",r.debounce((()=>{u.onScroll()}),100));i.request({url:window.ROBROY.args.apiFoldersPath,callback:e=>{e?u.listCallback(e):i.request({url:`${window.ROBROY.args.apiPath}?type=folders`,callback:e=>{u.listCallback(e)}})},errorCallback:()=>{i.request({url:`${window.ROBROY.args.apiPath}?type=folders`,callback:e=>{u.listCallback(e)}})}})}static listCallback(e){let t,o;if(window.ROBROY.folders=e.data,t=""===window.ROBROY.currentFolderId?{id:"",type:"folders",attributes:{name:""}}:window.ROBROY.folders[window.ROBROY.currentFolderId],t){if(window.ROBROY.currentFolder=t,""!==window.ROBROY.currentFolderId&&class{static init(){const e=document.createElement("ul");e.setAttribute("class","robroy-breadcrumb"),window.ROBROY.elements.$container.prepend(e);let t=window.ROBROY.currentFolder;do{e.prepend(this.item(t.id,t.attributes.name)),t=window.ROBROY.folders[s.getParentId(t.id)]}while(t);e.prepend(this.item("",window.ROBROY.args.rootFolderName))}static item(e,t){const r=document.createElement("li");if(r.setAttribute("class","robroy-breadcrumb-item"),e===window.ROBROY.currentFolderId)r.innerText=t;else{const o=document.createElement("a");o.setAttribute("class","robroy-breadcrumb-link"),o.setAttribute("href",e?`?folder=${e}`:window.location.pathname),o.innerText=t,r.prepend(o)}return r}}.init(),t.attributes.name&&r.setMetaTitle(t.attributes.name),""===window.ROBROY.currentFolderId)o=Object.values(window.ROBROY.folders).filter((e=>!e.id.includes("/")));else{const e=window.ROBROY.currentFolderId.split("/").length+1;o=Object.values(window.ROBROY.folders).filter((t=>!!t.id.startsWith(`${window.ROBROY.currentFolderId}/`)&&e===t.id.split("/").length))}o.length>0&&u.appendFolders(o),c.init(),u.loadImages((()=>{u.onScroll()})),window.addEventListener("scroll",r.debounce((()=>{u.onScroll()}),100)),r.callback("afterLoadFolder")}else a.show("Error: This folder does not exist.")}static loadImages(e){window.ROBROY.args.isLoadingImages=!0;let t=[window.ROBROY.args.apiPath,"?type=images&page[number]="+ ++window.ROBROY.args.pageNumber,`&page[size]=${window.ROBROY.args.pageSize}`].join("");window.ROBROY.args.showAllImages||(t+=`&parent=${window.ROBROY.currentFolderId}`),i.request({url:t,callback:t=>{if(t.data.forEach((e=>{window.ROBROY.currentImages[e.id]=e})),u.appendImages(t.data),window.ROBROY.grid.resizeAllItems(),window.ROBROY.args.isLoadingImages=!1,t.meta.page_number>=t.meta.total_pages&&(window.ROBROY.args.allPagesLoaded=!0),t.meta.num_items!==window.ROBROY.currentNumImages&&(window.ROBROY.currentNumImages=t.meta.num_items,r.setNumImages()),t.meta.total_pages<=0&&!d.hasFolders()){const e=document.getElementById("robroy-delete-folder");e&&(e.style.display="")}e&&e(),r.callback("afterLoadImage")}})}static onScroll(){if(window.ROBROY.args.allPagesLoaded||window.ROBROY.args.isLoadingImages)return;const e=document.querySelector("#robroy-images > figure:last-of-type");if(!e)return;const t=e.offsetTop;window.pageYOffset+window.innerHeight>t&&u.loadImages()}static appendImages(e){e.forEach((e=>{window.ROBROY.elements.$imageList.appendChild(l.element(e))}))}static appendFolders(e){e.forEach((e=>{window.ROBROY.elements.$folderList.appendChild(s.element(e))}))}}class m{constructor(e){(e=e||{}).allPagesLoaded=!1,e.apiPath=e.apiPath||"/api.php",e.attributes=e.attributes||{},e.callbacks=e.callbacks||{},e.isLoadingImages=!1,e.metaTitleSeparator=e.metaTitleSeparator||" | ",e.pageNumber=0,e.pageSize=e.pageSize||8,e.rootFolderName=e.rootFolderName||"Home",e.selector=e.selector||"#robroy",e.showAllImages=e.showAllImages||!1,e.singularImageText=e.singularImageText||"image",e.pluralImageText=e.pluralImageText||"images",this.args=e;const t=document.querySelector(e.selector);if(!t)return;const r=document.createElement("div");r.setAttribute("id","robroy-folder-header"),t.appendChild(r);const o=document.createElement("ul");o.setAttribute("id","robroy-folders"),r.appendChild(o);const a=document.createElement("p");a.setAttribute("id","robroy-num"),r.appendChild(a);const n=document.createElement("div");n.setAttribute("id","robroy-images"),t.appendChild(n);const i=new URLSearchParams(window.location.search).get("folder");this.auth=document.querySelector('[data-action="authenticate"]'),this.elements={$container:t,$folderList:o,$imageList:n,$numImages:a},this.currentFolderId=i||"",this.currentFolder=null,this.currentImage=null,this.currentImages={},this.currentNumImages=null,this.folders=[]}static init(e){if(!r.propertyExists(window,"ROBROY")){if(window.ROBROY=new m(e),!window.ROBROY.elements.$imageList)return null;u.init(),window.ROBROY.grid=new o}return window.ROBROY}}})(),Robroy=t})();