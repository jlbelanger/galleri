var Robroy;(()=>{"use strict";var e={d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{e.r(t),e.d(t,{default:()=>m});class r{static addAttributes(e,t){window.ROBROY.args.attributes[e]&&Object.keys(window.ROBROY.args.attributes[e]).forEach((r=>{t.setAttribute(r,window.ROBROY.args.attributes[e][r])}))}static addError(e,t){e.classList.add("robroy-has-error");const r=document.createElement("span");r.setAttribute("class","robroy-error"),r.setAttribute("id","robroy-error-"+e.getAttribute("id")),r.innerText=t,e.after(r)}static callback(e){window.ROBROY.args.callbacks[e]&&window.ROBROY.args.callbacks[e]()}static debounce(e,t,r,...a){var o;return function(){var i=this,n=r&&!o;clearTimeout(o),o=setTimeout((function(){o=null,r||e.apply(i,a)}),t),n&&e.apply(i,a)}}static isLoggedIn(){return window.localStorage.getItem("authenticated")}static propertyExists(e,t){return Object.prototype.hasOwnProperty.call(e,t)}static setMetaTitle(e){var t=document.querySelector("title");t.innerText=e+window.ROBROY.args.metaTitleSeparator+t.innerText}static setNumImages(){const e=1===window.ROBROY.currentNumImages?window.ROBROY.args.singularImageText:window.ROBROY.args.pluralImageText;window.ROBROY.elements.numImages.innerText=window.ROBROY.currentNumImages.toLocaleString()+" "+e}}class a{constructor(){this.calculate(),window.addEventListener("resize",r.debounce((()=>{this.calculate(),this.resizeAllItems()}),100))}calculate(){var e=window.getComputedStyle(window.ROBROY.elements.imageList);this.gridRowHeight=parseInt(e.getPropertyValue("grid-auto-rows"),10),this.gridRowGap=parseInt(e.getPropertyValue("grid-row-gap"),10)}checkResizeItem(e){var t=e.querySelector("img");if(t.complete)this.resizeItem(e);else var r=setInterval((()=>{t.complete&&(clearInterval(r),this.resizeItem(e))}),100)}resizeItem(e){var t=e.querySelector("a");t.style.position="";var r=t.getBoundingClientRect().height,a=Math.ceil((r+this.gridRowGap)/(this.gridRowHeight+this.gridRowGap));t.style.position="absolute",e.style.gridRowEnd="span "+a}resizeAllItems(){[...document.getElementsByClassName("robroy-figure")].forEach((e=>{this.checkResizeItem(e)}))}}class o{static show(e,t){(t=t||{}).closeButtonText=t.closeButtonText||"OK",t.closeButtonClass=t.closeButtonClass||"";var a="robroy-modal-"+(new Date).getTime(),i=document.createElement("div");i.setAttribute("id",a),i.setAttribute("class","robroy-modal"),i.setAttribute("role","alert");var n=document.createElement("div");n.setAttribute("class","robroy-modal-box"),i.appendChild(n);var d,l=document.createElement("p");if(l.setAttribute("class","robroy-modal-text"),t.html?l.innerHTML=e:t.append?l.appendChild(e):l.innerText=e,n.appendChild(l),!t.hideClose||t.showCancel){var s=document.createElement("p");if(s.setAttribute("class","robroy-modal-options"),n.appendChild(s),t.hideClose||((d=document.createElement("button")).setAttribute("id","robroy-modal-close"),d.setAttribute("type","button"),d.setAttribute("class",("robroy-button "+t.closeButtonClass).trim()),d.setAttribute("data-id",a),d.setAttribute("data-robroy-modal-close",""),t.closeButtonAttributes&&Object.keys(t.closeButtonAttributes).forEach((e=>{d.setAttribute(e,t.closeButtonAttributes[e])})),d.innerText=t.closeButtonText,d.addEventListener("click",(e=>{r.propertyExists(t,"callback")?t.callback(e):o.hide(e)})),s.appendChild(d),document.addEventListener("keydown",o.keydownListener,!1)),t.showCancel){var c=document.createElement("button");c.setAttribute("id","robroy-modal-cancel"),c.setAttribute("type","button"),c.setAttribute("class","robroy-button robroy-button--secondary"),c.setAttribute("data-id",a),c.innerText="Cancel",c.addEventListener("click",this.hide),s.appendChild(c)}}document.body.appendChild(i),d&&(window.ROBROY.activeElement=document.activeElement,d.focus())}static keydownListener(e){"Escape"===e.key&&(o.hide(),document.removeEventListener("keydown",o.keydownListener))}static hide(e){let t;t=e&&e.target?e.target:document.querySelector("[data-robroy-modal-close]");const r=document.getElementById(t.getAttribute("data-id"));r.parentNode.removeChild(r),window.ROBROY.activeElement&&(window.ROBROY.activeElement.focus(),window.ROBROY.activeElement=null)}}class i{static show(){var e=document.querySelector(".robroy-spinner");e||((e=document.createElement("div")).setAttribute("class","robroy-spinner"),document.body.appendChild(e)),e.style.display=""}static hide(){document.querySelector(".robroy-spinner").style.display="none"}}class n{static request(e){(e=e||{}).method=e.method||"GET",i.show();var t=new XMLHttpRequest;t.onreadystatechange=()=>{if(t.readyState===XMLHttpRequest.DONE){i.hide();var r=t.responseText;if(r||!(t.status<200||t.status>299)){if(r&&!e.noParse){try{r=JSON.parse(r)}catch(e){return void o.show("Error: The server returned a non-JSON response.")}if(r.errors){var a=r.errors.map((e=>e.title));return void o.show("Error: "+a)}}e.callback(r,t.status)}else o.show("Error: The server returned a "+t.status+" error.")}},t.open(e.method,e.url,!0),e.json?(t.setRequestHeader("Content-Type","application/json"),t.send(e.json)):t.send(e.formData)}}class d{static isEmpty(){const e=window.getComputedStyle(window.ROBROY.elements.imageList),t=window.getComputedStyle(window.ROBROY.elements.folderList);return"none"===e.display&&"none"===t.display}static getImages(){return document.querySelectorAll("#robroy-images > figure")}static getFolders(){return document.querySelectorAll("#robroy-folders > li")}static hasImages(){return d.getImages().length>0}static hasFolders(){return d.getFolders().length>0}}class l{static element(e){var t=document.createElement("li");t.setAttribute("class","robroy-folder"),t.setAttribute("data-path",e.id),t.setAttribute("data-name",e.attributes.name);var r=document.createElement("a");return r.setAttribute("class","robroy-folder-link"),r.setAttribute("href","?folder="+e.id),r.innerText=e.attributes.name,t.appendChild(r),t}static addEditControls(){var e=document.createElement("div");e.setAttribute("class","robroy-admin robroy-form robroy-form-container");var t=l.form("Edit","edit","put",l.edit);t.setAttribute("class","robroy-form robroy-form--folder"),e.appendChild(t);var r=document.createElement("button");r.setAttribute("class","robroy-button robroy-button--danger robroy-form--delete"),r.setAttribute("id","robroy-delete-folder"),r.setAttribute("type","button"),r.innerText="Delete Folder",d.isEmpty()||(r.style.display="none"),r.addEventListener("click",l.delete),e.appendChild(r),window.ROBROY.container.prepend(e)}static addCreateControl(){var e=l.form("Create","create","post",l.create);e.setAttribute("class","robroy-admin robroy-form robroy-form--folder robroy-form-container"),window.ROBROY.container.prepend(e)}static form(e,t,r,a){var o=document.createElement("form");o.setAttribute("action",window.ROBROY.args.apiPath+"?type=folders"),o.setAttribute("id","robroy-"+t+"-folder-form"),o.setAttribute("method",r),o.addEventListener("submit",a);var i=document.createElement("h2");i.setAttribute("class","robroy-heading"),i.innerText=e+" Folder",o.appendChild(i);var n=document.createElement("label");n.setAttribute("class","robroy-label"),n.setAttribute("for","robroy-"+t+"-folder-name"),n.innerText="Name:",o.appendChild(n);var d=document.createElement("input");d.setAttribute("class","robroy-input"),d.setAttribute("id","robroy-"+t+"-folder-name"),d.setAttribute("name","name"),d.setAttribute("type","text"),o.appendChild(d),"edit"===t&&d.setAttribute("value",window.ROBROY.currentFolder.attributes.name);var s=document.createElement("label");s.setAttribute("class","robroy-label"),s.setAttribute("for","robroy-"+t+"-folder-parent"),s.innerText="Parent:",o.appendChild(s);var c=document.createElement("select");c.setAttribute("class","robroy-select"),c.setAttribute("id","robroy-"+t+"-folder-parent"),c.setAttribute("name","parent"),o.appendChild(c),l.addFolderOptions(t,c);var u=document.createElement("button");return u.setAttribute("class","robroy-button"),u.setAttribute("id","robroy-"+t+"-submit"),u.setAttribute("type","submit"),u.innerText=e,o.appendChild(u),o}static addFolderOptions(e,t,r=null){t.innerText="";var a=document.createElement("option");a.setAttribute("value",""),t.appendChild(a),window.ROBROY.folders.forEach((function(o){(a=document.createElement("option")).setAttribute("value",o.id),a.innerText=l.getFullName(o),r?o.id===r&&a.setAttribute("selected","selected"):"create"===e?o.id===window.ROBROY.currentFolderId&&a.setAttribute("selected","selected"):"edit"===e&&window.ROBROY.currentFolder.relationships.parent&&o.id===window.ROBROY.currentFolder.relationships.parent.id&&a.setAttribute("selected","selected"),t.appendChild(a)}))}static delete(){var e=window.ROBROY.currentFolderId;o.show('Are you sure you want to delete the folder "'+e+'"?',{closeButtonText:"Delete",closeButtonClass:"robroy-button--danger",showCancel:!0,callback:()=>{l.deleteCallback(e),o.hide()}})}static deleteCallback(e){n.request({method:"DELETE",url:window.ROBROY.args.apiPath+"?type=folders&id="+e,callback:()=>{r.callback("afterDeleteFolder"),window.location=window.location.href.replace("?folder="+window.ROBROY.currentFolderId,window.ROBROY.currentFolder.relationships.parent?"?folder="+window.ROBROY.currentFolder.relationships.parent.id:"")}})}static create(e){if(e.preventDefault(),document.getElementById("robroy-create-folder-name").value){var t=document.getElementById("robroy-create-folder-form"),r=new FormData(t);n.request({method:t.getAttribute("method"),url:t.getAttribute("action"),formData:r,callback:e=>{l.createCallback(e)}})}else o.show("Error: Please enter a name.")}static createCallback(e){if(e.data.relationships.parent&&e.data.relationships.parent.id===window.ROBROY.currentFolderId||!e.data.relationships.parent&&!window.ROBROY.currentFolderId){l.prependItems([e.data]);var t=document.getElementById("robroy-delete-folder");t&&(t.style.display="none")}document.getElementById("robroy-create-folder-name").value="",window.ROBROY.folders.push(e.data),window.ROBROY.folders=window.ROBROY.folders.sort(((e,t)=>e.id.localeCompare(t.id)));const a=document.getElementById("robroy-create-folder-parent");l.addFolderOptions("create",a,a.value);const o=document.getElementById("robroy-edit-folder-parent");o&&l.addFolderOptions("edit",o),r.callback("afterCreateFolder")}static edit(e){e.preventDefault();var t=document.getElementById("robroy-edit-folder-name");if(t.value){var r,a=document.getElementById("robroy-edit-folder-parent"),i=t.value!==window.ROBROY.currentFolder.attributes.name;if(r=window.ROBROY.currentFolder.relationships.parent?a.value!==window.ROBROY.currentFolder.relationships.parent.id:!!a.value,i||r){var d=document.getElementById("robroy-edit-folder-form"),s=new FormData(d),c={};s.forEach(((e,t)=>{c[t]=e})),c=JSON.stringify(c),n.request({method:d.getAttribute("method"),url:d.getAttribute("action")+"&id="+window.ROBROY.currentFolderId,json:c,callback:e=>{l.editCallback(e)}})}else o.show("Nothing to update.")}else o.show("Error: Please enter a name.")}static editCallback(e){r.callback("afterEditFolder"),window.location=window.location.href.replace("?folder="+window.ROBROY.currentFolderId,"?folder="+e.data.id)}static prependItems(e){e.forEach((e=>{window.ROBROY.elements.folderList.prepend(l.element(e))}))}static getFullName(e){const t=[e.attributes.name];for(;e.relationships.parent;)e=e.relationships.parent,t.push(e.attributes.name);return t.reverse().join(" > ")}}class s{static element(e){var t=document.createElement("figure");t.setAttribute("class","robroy-figure"),t.setAttribute("data-path",e.id),r.addAttributes("figure",t);var a=document.createElement("a");a.setAttribute("class","robroy-link"),a.setAttribute("href",e.attributes.url),a.style.backgroundImage='url("'+e.attributes.thumbnail+'")',r.addAttributes("a",a),t.appendChild(a);var o=document.createElement("img");return o.setAttribute("class","robroy-img"),o.setAttribute("src",e.attributes.thumbnail),o.setAttribute("height",e.attributes.thumbnailHeight),o.setAttribute("width",e.attributes.thumbnailWidth),r.addAttributes("img",o),a.appendChild(o),r.isLoggedIn()&&s.addEditControls(t),t}static addEditControls(e){var t=document.createElement("div");t.setAttribute("class","robroy-button-container"),e.appendChild(t);var r=document.createElement("button");r.setAttribute("class","robroy-admin robroy-button"),r.setAttribute("href","button"),r.innerText="View",r.addEventListener("click",s.view),t.appendChild(r);var a=document.createElement("button");a.setAttribute("class","robroy-admin robroy-button robroy-button--danger"),a.setAttribute("type","button"),a.innerText="Delete",a.addEventListener("click",s.delete),t.appendChild(a);var o=document.createElement("button");o.setAttribute("class","robroy-admin robroy-button robroy-button--secondary"),o.setAttribute("type","button"),o.innerText="Edit",o.addEventListener("click",s.edit),t.appendChild(o),e.querySelector(".robroy-link").style.pointerEvents="none"}static addCreateControl(){var e=document.createElement("form");e.setAttribute("action",window.ROBROY.args.apiPath+"?type=images"),e.setAttribute("class","robroy-admin robroy-form robroy-form--image robroy-form-container"),e.setAttribute("enctype","multipart/form-data"),e.setAttribute("id","robroy-create-image-form"),e.setAttribute("method","post"),e.addEventListener("submit",s.create);var t=document.createElement("div");t.setAttribute("id","robroy-create-image-container"),e.appendChild(t);var r=document.createElement("input");r.setAttribute("accept","image/*"),r.setAttribute("id","robroy-create-image-input"),r.setAttribute("name","upload[]"),r.setAttribute("multiple","multiple"),r.setAttribute("title","Select images to upload"),r.setAttribute("type","file"),r.addEventListener("change",s.onChange),t.appendChild(r);var a=document.createElement("div");a.setAttribute("id","robroy-create-image-text"),a.innerText="Drag images or click here to upload.",t.appendChild(a);var o=document.createElement("button");o.setAttribute("class","robroy-button"),o.setAttribute("id","robroy-create-image-button"),o.setAttribute("type","submit"),o.innerText="Upload",e.appendChild(o);var i=document.createElement("input");i.setAttribute("name","folder"),i.setAttribute("value",window.ROBROY.currentFolderId),i.setAttribute("type","hidden"),e.appendChild(i),window.ROBROY.container.prepend(e)}static delete(e){var t=e.target.closest("[data-path]").getAttribute("data-path");o.show('Are you sure you want to delete "'+t+'"?',{closeButtonText:"Delete",closeButtonClass:"robroy-button--danger",showCancel:!0,callback:()=>{s.deleteCallback(t),o.hide()}})}static deleteCallback(e){n.request({method:"DELETE",url:window.ROBROY.args.apiPath+"?type=images&path="+e,callback:()=>{s.removeImageFromList(e),r.callback("afterDeleteImage")}})}static removeImageFromList(e){var t,a=document.querySelector('[data-path="'+e+'"]');if(a.nextSibling&&(t=[...a.nextSibling.children].find((e=>"A"===e.tagName))),a.parentNode.removeChild(a),window.ROBROY.currentNumImages-=1,r.setNumImages(),d.hasImages())window.ROBROY.grid.resizeAllItems(),t&&t.focus();else if(!d.hasFolders()){var o=document.getElementById("robroy-delete-folder");o&&(o.style.display="")}}static onChange(e){var t=[...e.target.files].map((e=>e.name));document.getElementById("robroy-create-image-text").innerText=t.join(", "),document.getElementById("robroy-create-image-button").style.display="flex"}static create(e){if(e.preventDefault(),document.getElementById("robroy-create-image-input").files.length<=0)o.show("Error: No files selected.");else{var t=document.getElementById("robroy-create-image-form"),r=new FormData(t);n.request({method:t.getAttribute("method"),url:t.getAttribute("action"),formData:r,callback:e=>{s.createCallback(e)}})}}static createCallback(e){s.prependItems(e.data),window.ROBROY.grid.resizeAllItems(),e.data.forEach((e=>{window.ROBROY.currentImages[e.id]=e})),window.ROBROY.currentNumImages+=e.data.length,r.setNumImages(),document.getElementById("robroy-create-image-input").value="",document.getElementById("robroy-create-image-text").innerText="Drag files or click here to upload.",document.getElementById("robroy-create-image-button").style.display="";var t=document.getElementById("robroy-delete-folder");t&&(t.style.display="none"),r.callback("afterCreateImage")}static edit(e){var t=e.target.closest("[data-path]").getAttribute("data-path");window.ROBROY.currentImage=window.ROBROY.currentImages[t];var r=document.createElement("form");r.setAttribute("action",window.ROBROY.args.apiPath+"?type=images"),r.setAttribute("id","robroy-edit-image-form"),r.setAttribute("method","PUT"),r.addEventListener("submit",s.editCallback);var a=document.createElement("h2");a.setAttribute("class","robroy-heading"),a.innerText="Edit Image",r.appendChild(a);var i=document.createElement("div");i.setAttribute("class","robroy-fields"),r.appendChild(i);var n=document.createElement("label");n.setAttribute("class","robroy-label"),n.setAttribute("for","robroy-edit-image-filename"),n.innerText="Filename:",i.appendChild(n);var d=document.createElement("input");d.setAttribute("class","robroy-input"),d.setAttribute("id","robroy-edit-image-filename"),d.setAttribute("name","filename"),d.setAttribute("type","text"),d.setAttribute("value",window.ROBROY.currentImage.attributes.filename),i.appendChild(d);var l=document.createElement("label");l.setAttribute("class","robroy-label"),l.setAttribute("for","robroy-edit-image-folder"),l.innerText="Folder:",i.appendChild(l);var c=document.createElement("select");c.setAttribute("class","robroy-select"),c.setAttribute("id","robroy-edit-image-folder"),c.setAttribute("name","folder"),i.appendChild(c),s.addFolderOptions(c),o.show(r,{append:!0,callback:s.submitEditFormCallback,closeButtonAttributes:{id:"robroy-edit-image-submit",form:"robroy-edit-image-form",type:"submit"},closeButtonText:"Save",showCancel:!0})}static submitEditFormCallback(e){e.preventDefault(),document.querySelectorAll("#robroy-edit-image-form .robroy-has-error").forEach((e=>{e.classList.remove("robroy-has-error")})),document.querySelectorAll("#robroy-edit-image-form .robroy-error").forEach((e=>{e.remove()}));var t=document.getElementById("robroy-edit-image-filename");if(t.value){var a=document.getElementById("robroy-edit-image-folder"),i=t.value!==window.ROBROY.currentImage.attributes.filename,d=a.value!==window.ROBROY.currentImage.attributes.folder;if(i||d){var l=document.getElementById("robroy-edit-image-form"),c=new FormData(l),u={};c.forEach(((e,t)=>{u[t]=e})),u=JSON.stringify(u),n.request({method:l.getAttribute("method"),url:l.getAttribute("action")+"&id="+window.ROBROY.currentImage.id,json:u,callback:t=>{d?s.removeImageFromList(window.ROBROY.currentImage.id):i&&s.updateImage(window.ROBROY.currentImage.id,t.data),delete window.ROBROY.currentImages[window.ROBROY.currentImage.id],window.ROBROY.currentImages[t.data.id]=t.data,window.ROBROY.currentImage=null,o.hide(e),r.callback("afterEditImage")}})}else o.hide(e)}else r.addError(t,"Error: Please enter a filename.")}static addFolderOptions(e){e.innerText="";var t=document.createElement("option");t.setAttribute("value",""),e.appendChild(t),window.ROBROY.folders.forEach((function(r){(t=document.createElement("option")).setAttribute("value",r.id),t.innerText=l.getFullName(r),r.id===window.ROBROY.currentImage.attributes.folder&&t.setAttribute("selected","selected"),e.appendChild(t)}))}static updateImage(e,t){const r=document.querySelector('[data-path="'+e+'"]');r.setAttribute("data-path",t.id),r.querySelector(".robroy-link").setAttribute("href",t.attributes.url)}static prependItems(e){e.forEach((e=>{window.ROBROY.elements.imageList.prepend(s.element(e))}))}static view(e){e.target.closest("[data-path]").querySelector(".robroy-link").click()}}class c{static init(){window.ROBROY.auth&&(window.ROBROY.auth.addEventListener("click",(()=>{c.authenticate()})),c.handleAuthentication())}static authenticate(){r.isLoggedIn()?c.logout():c.login()}static logout(){if(window.navigator.userAgent.indexOf("Safari")>-1)return window.localStorage.clear(),void c.handleLogout();var e=[window.location.protocol,"//log:out@",window.location.host,window.ROBROY.args.apiPath+"?type=sessions"].join("");n.request({method:"DELETE",url:e,noParse:!0,callback:()=>{window.localStorage.clear(),c.handleLogout()}})}static login(){n.request({method:"POST",url:window.ROBROY.args.apiPath+"?type=sessions",noParse:!0,callback:(e,t)=>{204===t?(window.localStorage.setItem("authenticated",!0),this.handleLogin()):o.show("Error: Invalid username or password.")}})}static handleAuthentication(){r.isLoggedIn()?c.handleLogin():c.handleLogout()}static handleLogin(){window.ROBROY.auth.innerText="Log Out",d.getImages().forEach((e=>{s.addEditControls(e)})),s.addCreateControl(),l.addCreateControl(),window.ROBROY.currentFolderId&&l.addEditControls(),n.request({url:window.ROBROY.args.apiPath+"?type=folders",callback:e=>{window.ROBROY.folders=e.data;var t=document.getElementById("robroy-create-folder-parent");t&&l.addFolderOptions("create",t),(t=document.getElementById("robroy-edit-folder-parent"))&&l.addFolderOptions("edit",t)}})}static handleLogout(){window.ROBROY.auth.innerText="Log In";let e=document.querySelectorAll(".robroy-admin");e.forEach((e=>{e.parentNode.removeChild(e)})),e=document.querySelectorAll(".robroy-link"),e.forEach((e=>{e.style.pointerEvents=""}))}}class u{static init(){u.loadCurrentFolder()}static loadCurrentFolder(){if(window.ROBROY.args.showAllImages)return c.init(),u.loadImages((()=>{u.onScroll()})),void window.addEventListener("scroll",r.debounce((()=>{u.onScroll()}),100));n.request({url:window.ROBROY.args.apiPath+"?type=folders&id="+window.ROBROY.currentFolderId,callback:e=>{window.ROBROY.currentFolder=e.data,""!==window.ROBROY.currentFolderId&&class{static init(){const e=document.createElement("ul");e.setAttribute("class","robroy-breadcrumb"),window.ROBROY.container.prepend(e);let t=window.ROBROY.currentFolder;do{e.prepend(this.item(t.id,t.attributes.name)),t=t.relationships.parent}while(t);e.prepend(this.item("",window.ROBROY.args.rootFolderName))}static item(e,t){const r=document.createElement("li");if(r.setAttribute("class","robroy-breadcrumb-item"),e===window.ROBROY.currentFolderId)r.innerText=t;else{const a=document.createElement("a");a.setAttribute("class","robroy-breadcrumb-link"),a.setAttribute("href",e?`?folder=${e}`:window.location.pathname),a.innerText=t,r.prepend(a)}return r}}.init(),e.data.attributes.name&&r.setMetaTitle(e.data.attributes.name),e.data.relationships.folders.length>0&&u.appendFolders(e.data.relationships.folders),c.init(),u.loadImages((()=>{u.onScroll()})),window.addEventListener("scroll",r.debounce((()=>{u.onScroll()}),100)),r.callback("afterLoadFolder")}})}static loadImages(e){window.ROBROY.args.isLoadingImages=!0;var t=[window.ROBROY.args.apiPath,"?type=images&page[number]="+ ++window.ROBROY.args.pageNumber,"&page[size]="+window.ROBROY.args.pageSize].join("");window.ROBROY.args.showAllImages||(t+="&parent="+window.ROBROY.currentFolderId),n.request({url:t,callback:t=>{if(t.data.forEach((e=>{window.ROBROY.currentImages[e.id]=e})),u.appendImages(t.data),window.ROBROY.grid.resizeAllItems(),window.ROBROY.args.isLoadingImages=!1,t.meta.page_number>=t.meta.total_pages&&(window.ROBROY.args.allPagesLoaded=!0),t.meta.num_items!==window.ROBROY.currentNumImages&&(window.ROBROY.currentNumImages=t.meta.num_items,r.setNumImages()),t.meta.total_pages<=0&&!d.hasFolders()){var a=document.getElementById("robroy-delete-folder");a&&(a.style.display="")}e&&e(),r.callback("afterLoadImage")}})}static onScroll(){if(!window.ROBROY.args.allPagesLoaded&&!window.ROBROY.args.isLoadingImages){var e=document.querySelector("#robroy-images > figure:last-of-type");if(e){var t=e.offsetTop;window.pageYOffset+window.innerHeight>t&&u.loadImages()}}}static appendImages(e){e.forEach((e=>{window.ROBROY.elements.imageList.appendChild(s.element(e))}))}static appendFolders(e){e.forEach((e=>{window.ROBROY.elements.folderList.appendChild(l.element(e))}))}}class m{constructor(e){(e=e||{}).allPagesLoaded=!1,e.apiPath=e.apiPath||"/api.php",e.attributes=e.attributes||{},e.callbacks=e.callbacks||{},e.isLoadingImages=!1,e.metaTitleSeparator=e.metaTitleSeparator||" | ",e.pageNumber=0,e.pageSize=e.pageSize||8,e.rootFolderName=e.rootFolderName||"Home",e.selector=e.selector||"#robroy",e.showAllImages=e.showAllImages||!1,e.singularImageText=e.singularImageText||"image",e.pluralImageText=e.pluralImageText||"images",this.args=e;var t=document.querySelector(e.selector);if(t){var r=document.createElement("div");r.setAttribute("id","robroy-folder-header"),t.appendChild(r);var a=document.createElement("ul");a.setAttribute("id","robroy-folders"),r.appendChild(a);var o=document.createElement("p");o.setAttribute("id","robroy-num"),r.appendChild(o);var i=document.createElement("div");i.setAttribute("id","robroy-images"),t.appendChild(i);var n=new URLSearchParams(window.location.search).get("folder");this.auth=document.querySelector('[data-action="authenticate"]'),this.container=t,this.elements={folderList:a,imageList:i,numImages:o},this.currentFolderId=n||"",this.currentFolder=null,this.currentImage=null,this.currentImages={},this.currentNumImages=null,this.folders=[]}}static init(e){if(!r.propertyExists(window,"ROBROY")){if(window.ROBROY=new m(e),!window.ROBROY.elements.imageList)return null;u.init(),window.ROBROY.grid=new a}return window.ROBROY}}})(),Robroy=t})();