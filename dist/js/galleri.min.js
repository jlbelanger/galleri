!function(){"use strict";class e{static addField(e,t,a,l="text"){const i=document.createElement("div");i.setAttribute("class",`galleri-field galleri-field--${l}`),i.setAttribute("id",`galleri-field-${t}`),e.appendChild(i);const r=document.createElement("label");let n;return r.setAttribute("class","galleri-label"),r.setAttribute("for",`galleri-input-${t}`),r.innerText=a,i.appendChild(r),"select"===l?(n=document.createElement("select"),n.setAttribute("class","galleri-select")):(n=document.createElement("input"),n.setAttribute("class","galleri-input"),n.setAttribute("type",l)),n.setAttribute("id",`galleri-input-${t}`),n.setAttribute("name",t),i.appendChild(n),n}static callback(e,t){window.GALLERI.args.callbacks[e]&&window.GALLERI.args.callbacks[e](t)}static debounce(e,t,a){let l;return function(...i){const r=this,n=a&&!l;clearTimeout(l),l=setTimeout((()=>{l=null,a||e.apply(r,i)}),t),n&&e.apply(r,i)}}static isEmpty(){const e=window.getComputedStyle(window.GALLERI.elements.$imageList),t=window.getComputedStyle(window.GALLERI.elements.$folderList);return"none"===e.display&&"none"===t.display}static isLoggedIn(){return window.localStorage.getItem(window.GALLERI.args.localStorageKey)}static modifier(e,t){window.GALLERI.args.modifiers[e]&&window.GALLERI.args.modifiers[e](t)}static propertyExists(e,t){return Object.prototype.hasOwnProperty.call(e,t)}static setMetaTitle(e){const t=document.querySelector("title");t.innerText=e+window.GALLERI.args.metaTitleSeparator+t.innerText}static setPageTitle(t){let a=document.getElementById("galleri-folder-title-text");if(!a){const l=document.createElement("h1");l.setAttribute("id","galleri-folder-title"),window.GALLERI.elements.$container.prepend(l),a=document.createElement("span"),a.setAttribute("id","galleri-folder-title-text"),l.appendChild(a),window.GALLERI.elements.$numImages=document.createElement("small"),window.GALLERI.elements.$numImages.setAttribute("id","galleri-folder-num"),l.appendChild(window.GALLERI.elements.$numImages),e.modifier("title",{element:l,title:t})}a.innerText=t}static setNumImages(){const e=1===window.GALLERI.currentNumImages?window.GALLERI.lang.singularImageText:window.GALLERI.lang.pluralImageText;window.GALLERI.elements.$numImages.innerText=`(${window.GALLERI.currentNumImages.toLocaleString()} ${e})`}static sprintf(e,...t){return t.forEach((t=>{e=e.replace("%s",t)})),e}static toSlug(e){return e?e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/ & /g,"-and-").replace(/<[^>]+>/g,"").replace(/['â€™.]/g,"").replace(/[^a-z0-9-]+/g,"-").replace(/^-+/,"").replace(/-+$/,"").replace(/--+/g,"-"):""}}class t{static init(t,a){let l=document.getElementById(a);return l||(l=document.createElement("div"),l.setAttribute("class","galleri-spinner"),l.setAttribute("id",a),l.setAttribute("role","status"),l.innerText=window.GALLERI.lang.loading,t.appendChild(l),l.classList.remove("galleri-spinner--hide"),e.modifier("spinner",{element:l})),l}static show(){let e=document.getElementById("galleri-modal-spinner");return e||(e=document.getElementById("galleri-spinner")),e.classList.remove("galleri-spinner--hide"),e}static hide(e){e.classList.add("galleri-spinner--hide")}}class a{static show(l,i={}){i.closeButtonText=i.closeButtonText||window.GALLERI.lang.ok,i.closeButtonClass=i.closeButtonClass||"",document.body.classList.add("galleri-modal-open");const r=`galleri-modal-${(new Date).getTime()}`,n=document.createElement("dialog");n.setAttribute("id",r),n.setAttribute("class","galleri-modal"),n.setAttribute("tabindex","-1");const o=document.createElement("div");o.setAttribute("aria-live","polite"),o.setAttribute("class","galleri-toast-container"),o.setAttribute("id","galleri-modal-toast-container"),o.setAttribute("role","alert"),n.appendChild(o);const d=t.init(n,"galleri-modal-spinner");t.hide(d);const s=document.createElement("div");if(s.setAttribute("class","galleri-modal-box"),n.appendChild(s),i.append)s.appendChild(l);else{const e=document.createElement("p");e.setAttribute("class","galleri-modal-text"),e.innerText=l,s.appendChild(e)}let c;if(!i.hideClose||i.showCancel){const t=document.createElement("p");if(t.setAttribute("class","galleri-modal-options"),s.appendChild(t),!i.hideClose){const l=t=>{e.propertyExists(i,"callback")?i.callback(t):a.hide(t)};c=document.createElement("button"),c.setAttribute("id","galleri-modal-close"),c.setAttribute("type","button"),c.setAttribute("class",`galleri-button ${i.closeButtonClass}`.trim()),c.setAttribute("data-galleri-modal-close",""),i.closeButtonAttributes&&Object.keys(i.closeButtonAttributes).forEach((e=>{c.setAttribute(e,i.closeButtonAttributes[e])})),c.innerText=i.closeButtonText,c.addEventListener("click",l),t.appendChild(c),document.addEventListener("keydown",a.keydownListener,!1),n.addEventListener("click",a.onClickDialog)}if(i.showCancel){const e=document.createElement("button");e.setAttribute("id","galleri-modal-cancel"),e.setAttribute("type","button"),e.setAttribute("class","galleri-button galleri-button--secondary"),e.innerText=window.GALLERI.lang.cancel,e.addEventListener("click",this.hide),t.appendChild(e)}}return document.body.appendChild(n),window.GALLERI.activeElement=document.activeElement,n.showModal(),n.focus(),e.modifier("modal",{element:n}),n}static keydownListener(e){"Escape"===e.key&&a.hide()}static onClickDialog(e){"DIALOG"===e.target.tagName&&a.hide()}static hide(e){let t;document.removeEventListener("keydown",a.keydownListener),document.body.classList.remove("galleri-modal-open"),t=e&&e.target?e.target:document.querySelector("[data-galleri-modal-close]");t.closest(".galleri-modal").remove(),window.GALLERI.activeElement&&(window.GALLERI.activeElement.focus(),window.GALLERI.activeElement=null)}}class l{static request(a){(a=a||{}).method=a.method||"GET";const i=t.show();window.GALLERI.state.numRequestsInProgress+=1;const r=new XMLHttpRequest;r.onreadystatechange=()=>{if(r.readyState!==XMLHttpRequest.DONE)return;window.GALLERI.state.numRequestsInProgress-=1,window.GALLERI.state.numRequestsInProgress<=0&&t.hide(i);let e=r.responseText;if(e||!(r.status<200||r.status>299)){if(e&&!a.noParse)try{e=JSON.parse(e)}catch(t){return void l.error(a,e,r)}r.status<200||r.status>299?l.error(a,e,r):a.callback(e,r.status)}else l.error(a,e,r)};let n=a.url;a.url.endsWith(".json")&&e.isLoggedIn()&&(n+=`?t=${Date.now()}`),r.open(a.method,n,!0),a.json?(r.setRequestHeader("Content-Type","application/json"),r.send(a.json)):r.send(a.formData)}static error(t,l,i){t.errorCallback?t.errorCallback(l,i.status):a.show(e.sprintf(window.GALLERI.lang.error+window.GALLERI.lang.errorStatus,i.status))}}class i{static add(e,t){e.setAttribute("aria-invalid",!0);const a=e.closest(".galleri-field");a.classList.add("galleri-has-error");const l=document.createElement("span");l.setAttribute("class","galleri-error"),l.setAttribute("id",`galleri-error-${e.getAttribute("id")}`),l.innerText=t,a.append(l)}static clear(e){let t=e.querySelectorAll(".galleri-error");t.forEach((e=>{e.remove()})),t=e.querySelectorAll(".galleri-has-error"),t.forEach((e=>{e.classList.remove("galleri-has-error"),e.removeAttribute("aria-invalid")}))}static show(t,l){if(t.errors){const r=[];t.errors.forEach((e=>{if(e.pointer){const t=document.getElementById(`galleri-input-${e.pointer}`);t?i.add(t,window.GALLERI.lang.error+e.title):r.push(e.title)}else r.push(e.title)})),r.length>0&&a.show(e.sprintf(window.GALLERI.lang.error+r.join(" "),l))}else a.show(e.sprintf(window.GALLERI.lang.error+window.GALLERI.lang.errorStatus,l))}}class r{static show(t,a={}){a.class=a.class||"",a.closeButtonClass=a.closeButtonClass||"",a.closeButtonText=a.closeButtonText||window.GALLERI.lang.close,a.duration=a.duration||3e3;const l=`galleri-toast-${(new Date).getTime()}`,i=document.createElement("div");i.setAttribute("class",`galleri-toast ${a.class}`.trim()),i.setAttribute("id",l),i.style.animationDuration=`${a.duration}ms`;const n=document.createElement("p");if(n.setAttribute("class","galleri-toast-text"),n.innerText=t,i.appendChild(n),!a.hideClose){const e=e=>{r.hide(e)},t=document.createElement("button");t.setAttribute("aria-label",a.closeButtonText),t.setAttribute("class",`galleri-toast-close ${a.closeButtonClass}`.trim()),t.setAttribute("type","button"),a.closeButtonAttributes&&Object.keys(a.closeButtonAttributes).forEach((e=>{t.setAttribute(e,a.closeButtonAttributes[e])})),t.addEventListener("click",e),i.appendChild(t)}let o=document.getElementById("galleri-modal-toast-container");return o||(o=document.getElementById("galleri-toast-container")),o.appendChild(i),e.modifier("toast",{element:i}),setTimeout((()=>{i.remove()}),a.duration+1e3),i}static hide(e){e.target.closest(".galleri-toast").remove()}}class n{static load(){window.GALLERI.state.isLoadingFolder=!0,l.request({url:window.GALLERI.args.apiFoldersPath,callback:e=>{e?n.loadFolderCallback(e):l.request({url:`${window.GALLERI.args.apiPath}?type=folders`,callback:e=>{n.loadFolderCallback(e)}})},errorCallback:()=>{l.request({url:`${window.GALLERI.args.apiPath}?type=folders`,callback:e=>{n.loadFolderCallback(e)}})}})}static getCurrentFolderId(){if(!window.GALLERI.args.enableRewrites){return new URLSearchParams(window.location.search).get("folder")||""}return window.location.pathname.replace(/^\/+/,"")}static loadFolderCallback(t){const l=n.getCurrentFolderId();let i,r;if(window.GALLERI.folders=t.data,i=""===l?{id:"",type:"folders",attributes:{name:""}}:window.GALLERI.folders[l],i){if(window.GALLERI.currentFolder=i,""!==window.GALLERI.currentFolder.id&&n.initBreadcrumb(),i.attributes.name&&e.setMetaTitle(i.attributes.name),e.setPageTitle(i.attributes.name?i.attributes.name:window.GALLERI.lang.home),""===window.GALLERI.currentFolder.id)r=Object.values(window.GALLERI.folders).filter((e=>!e.id.includes("/")));else{const e=window.GALLERI.currentFolder.id.split("/").length+1;r=Object.values(window.GALLERI.folders).filter((t=>!!t.id.startsWith(`${window.GALLERI.currentFolder.id}/`)&&e===t.id.split("/").length))}r.length>0&&n.appendItems(r),window.GALLERI.state.isLoadingFolder=!1,e.callback("afterLoadFolder",{folder:i})}else a.show(window.GALLERI.lang.error+window.GALLERI.lang.errorFolderDoesNotExist)}static url(e){return window.GALLERI.args.enableRewrites?`/${e.id}`:`/?folder=${e.id}`}static element(t){const a=document.createElement(window.GALLERI.args.folderItemElement);a.setAttribute("class","galleri-folder"),a.setAttribute("data-path",t.id);const l=document.createElement("a");if(l.setAttribute("class","galleri-folder-link"),l.setAttribute("href",n.url(t)),a.appendChild(l),t.attributes.thumbnail){const e=document.createElement("img");e.setAttribute("class","galleri-folder-img"),e.setAttribute("src",t.attributes.thumbnail),l.appendChild(e)}const i=document.createElement("div");return i.setAttribute("class","galleri-folder-name"),i.innerText=t.attributes.name,l.appendChild(i),e.modifier("folderItem",{element:a,folder:t}),a}static showCreateForm(){const t=n.form(window.GALLERI.lang.titleCreateFolder,"post",n.submitCreateFormCallback),l=t.querySelector("#galleri-input-parent");l&&n.addFolderOptions(l,window.GALLERI.currentFolder.id);const i=t.querySelector("#galleri-field-parent");Object.keys(window.GALLERI.folders).length<=0?i.style.display="none":i.style.display="",e.modifier("folderCreateForm",{addField:e.addField,form:t}),a.show(t,{append:!0,callback:n.submitCreateFormCallback,closeButtonAttributes:{form:"galleri-folder-form",type:"submit"},closeButtonText:window.GALLERI.lang.save,showCancel:!0})}static showEditForm(){const t=n.form(window.GALLERI.lang.titleEditFolder,"put",n.submitEditFormCallback,window.GALLERI.currentFolder.id),l=t.querySelector("#galleri-input-parent");l&&n.addFolderOptions(l,n.getParentId(window.GALLERI.currentFolder.id));const i=t.querySelector("#galleri-field-parent");Object.keys(window.GALLERI.folders).length<=0?i.style.display="none":i.style.display="";const r=t.querySelector("#galleri-input-id");r&&(r.value=window.GALLERI.currentFolder.id.replace(/^.+\/([^/]+)$/,"$1")),Object.keys(window.GALLERI.currentFolder.attributes).forEach((e=>{const a=t.querySelector(`#galleri-input-${e}`);a&&a.setAttribute("value",window.GALLERI.currentFolder.attributes[e])})),e.modifier("folderEditForm",{addField:e.addField,form:t}),a.show(t,{append:!0,callback:n.submitEditFormCallback,closeButtonAttributes:{form:"galleri-folder-form",type:"submit"},closeButtonText:window.GALLERI.lang.save,showCancel:!0})}static form(t,a,l,i=""){const r=document.createElement("form");let n=`${window.GALLERI.args.apiPath}?type=folders`;i&&(n+=`&id=${i}`),r.setAttribute("action",n),r.setAttribute("id","galleri-folder-form"),r.setAttribute("method",a),r.addEventListener("submit",l);const o=document.createElement("h2");o.setAttribute("class","galleri-heading"),o.innerText=t,r.appendChild(o);const d=document.createElement("div");d.setAttribute("class","galleri-fields"),r.appendChild(d);const s=e.addField(d,"name",window.GALLERI.lang.fieldFolderName),c=e.addField(d,"id",window.GALLERI.lang.fieldFolderId);return e.addField(d,"parent",window.GALLERI.lang.fieldFolderParent,"select"),e.addField(d,"thumbnail",window.GALLERI.lang.fieldFolderThumbnail),s.addEventListener("keyup",(t=>{c.value=e.toSlug(t.target.value)})),s.addEventListener("change",(t=>{c.value=e.toSlug(t.target.value)})),e.modifier("folderForm",{addField:e.addField,container:d,form:r}),r}static delete(){const t=window.GALLERI.currentFolder.id;a.show(e.sprintf(window.GALLERI.lang.confirmDeleteFolder,window.GALLERI.currentFolder.attributes.name),{closeButtonText:window.GALLERI.lang.delete,closeButtonClass:"galleri-button--danger",showCancel:!0,callback:()=>{n.deleteCallback(t),a.hide()}})}static deleteCallback(t){l.request({method:"DELETE",url:`${window.GALLERI.args.apiPath}?type=folders&id=${t}`,callback:()=>{e.callback("afterDeleteFolder",{id:t});const a=n.getParentId(window.GALLERI.currentFolder.id);window.location=window.location.href.replace(n.url(window.GALLERI.currentFolder),a?n.url(window.GALLERI.folders[a]):"")}})}static submitCreateFormCallback(e){e.preventDefault();const t=document.getElementById("galleri-folder-form");i.clear(t);const a=document.getElementById("galleri-input-name");if(!a.value)return void i.add(a,window.GALLERI.lang.validationRequired);const r=document.getElementById("galleri-input-id");if(!r.value)return void i.add(r,window.GALLERI.lang.validationRequired);const o=new FormData(t);let d={id:null,attributes:{}};o.forEach(((e,t)=>{"id"===t?d[t]=e:d.attributes[t]=e})),d=JSON.stringify(d),l.request({method:t.getAttribute("method"),url:t.getAttribute("action"),json:d,callback:e=>{n.createRequestCallback(e)},errorCallback:(e,t)=>{i.show(e,t)}})}static createRequestCallback(t){r.show(window.GALLERI.lang.createdSuccessfullyFolder,{class:"galleri-toast--success"});const a=n.getParentId(t.data.id);if(a&&a===window.GALLERI.currentFolder.id||!a&&!window.GALLERI.currentFolder.id){n.addToList(t.data);const e=document.getElementById("galleri-delete-folder");e&&(e.style.display="none")}document.getElementById("galleri-input-name").value="",document.getElementById("galleri-input-id").value="",window.GALLERI.folders[t.data.id]=t.data;const l=document.getElementById("galleri-input-parent");n.addFolderOptions(l,l.value);document.getElementById("galleri-field-parent").style.display="",e.callback("afterCreateFolder",{folder:t.data})}static submitEditFormCallback(e){e.preventDefault();const t=document.getElementById("galleri-folder-form");i.clear(t);const o=document.getElementById("galleri-input-name");if(!o.value)return void i.add(o,window.GALLERI.lang.validationRequired);const d=document.getElementById("galleri-input-id");if(!d.value)return void i.add(d,window.GALLERI.lang.validationRequired);const s=new FormData(t);let c={attributes:{}},u={attributes:{}};if(s.forEach(((e,t)=>{"id"===t?(c[t]=e,Object.prototype.hasOwnProperty.call(window.GALLERI.currentFolder,t)?u[t]=window.GALLERI.currentFolder[t].replace(/^.+\/([^/]+)$/,"$1"):u[t]=""):(c.attributes[t]=e,Object.prototype.hasOwnProperty.call(window.GALLERI.currentFolder.attributes,t)?u.attributes[t]=window.GALLERI.currentFolder.attributes[t]:u.attributes[t]="")})),c=JSON.stringify(c),u=JSON.stringify(u),c===u)return a.hide(e),void r.show(window.GALLERI.lang.nothingToSave);l.request({method:t.getAttribute("method"),url:t.getAttribute("action"),json:c,callback:e=>{n.editRequestCallback(e)},errorCallback:(e,t)=>{i.show(e,t)}})}static editRequestCallback(t){e.callback("afterEditFolder",{folder:t.data}),window.location=window.location.href.replace(n.url(window.GALLERI.currentFolder),n.url(t.data))}static appendItems(e){e.forEach((e=>{window.GALLERI.elements.$folderList.appendChild(n.element(e))}))}static addToList(e){let t;const a=window.GALLERI.elements.$folderList.children,l=a.length;let i;for(t=0;t<l&&a[t].getAttribute("data-path")<e.id;t+=1)i=a[t];i?i.after(n.element(e)):window.GALLERI.elements.$folderList.prepend(n.element(e))}static getFullName(e){const t=[e.attributes.name];let a=n.getParentId(e.id);for(;a&&window.GALLERI.folders[a];)e=window.GALLERI.folders[a],t.push(e.attributes.name),a=n.getParentId(e.id);return t.reverse().join(window.GALLERI.args.folderSeparator)}static getParentId(e){const t=e.lastIndexOf("/");return-1===t?"":e.substr(0,t)}static getFolders(){return document.querySelectorAll(`#galleri-folders > ${window.GALLERI.args.folderItemElement}`)}static hasFolders(){return n.getFolders().length>0}static addFolderOptions(e,t){e.innerText="";let a=document.createElement("option");a.setAttribute("value",""),e.appendChild(a);let l;Object.keys(window.GALLERI.folders).sort().forEach((i=>{l=window.GALLERI.folders[i],a=document.createElement("option"),a.setAttribute("value",l.id),a.innerText=n.getFullName(window.GALLERI.folders[l.id]),l.id===t&&a.setAttribute("selected","selected"),e.appendChild(a)}))}static initBreadcrumb(){const t=document.createElement("ul");t.setAttribute("class","galleri-breadcrumb"),window.GALLERI.elements.$container.prepend(t);let a=window.GALLERI.currentFolder;do{t.prepend(this.breadcrumbItem(a)),a=window.GALLERI.folders[n.getParentId(a.id)]}while(a);t.prepend(this.breadcrumbItem({id:"",attributes:{name:window.GALLERI.lang.home}})),e.modifier("breadcrumbList",{element:t,folder:window.GALLERI.currentFolder})}static breadcrumbItem(t){const a=document.createElement("li");if(a.setAttribute("class","galleri-breadcrumb-item"),t.id===window.GALLERI.currentFolder.id)a.innerText=t.attributes.name;else{const e=document.createElement("a");e.setAttribute("class","galleri-breadcrumb-link"),e.setAttribute("href",t.id?n.url(t):"/"),e.innerText=t.attributes.name,a.prepend(e)}return e.modifier("breadcrumbItem",{element:a,folder:t}),a}}class o{static load(){window.GALLERI.state.isLoadingImages=!0,l.request({url:window.GALLERI.args.apiImagesPath,callback:e=>{e?o.getImagesCallback(e):l.request({url:`${window.GALLERI.args.apiPath}?type=images`,callback:e=>{o.getImagesCallback(e)}})},errorCallback:()=>{l.request({url:`${window.GALLERI.args.apiPath}?type=images`,callback:e=>{o.getImagesCallback(e)}})}})}static getImagesCallback(t){const a=n.getCurrentFolderId();let l=Object.values(t.data);if(window.GALLERI.args.showAllImages||(l=l.filter((e=>e.attributes.folder===a))),e.modifier("images",{images:l}),l.forEach((e=>{window.GALLERI.currentImages[e.id]=e})),o.appendItems(l),window.GALLERI.grid&&window.GALLERI.grid.resizeAllItems(),window.GALLERI.state.allPagesLoaded=!0,window.GALLERI.currentNumImages=l.length,l.length<=0){if(!n.hasFolders()){const e=document.getElementById("galleri-delete-folder");e&&(e.style.display="")}}else{const e=document.getElementById("galleri-delete-folder");e&&(e.style.display="none")}window.GALLERI.state.isLoadingImages=!1,o.onScroll(),window.addEventListener("scroll",e.debounce((()=>{o.onScroll()}),100)),e.callback("afterLoadImages",{images:l})}static element(t,a=!1){const l=document.createElement(window.GALLERI.args.imageItemElement);l.setAttribute("class","galleri-figure"),l.setAttribute("data-path",t.id);const i=document.createElement("a");i.setAttribute("class","galleri-link"),i.setAttribute("href",t.meta.url),l.appendChild(i);const r=document.createElement("img");return t.attributes.title&&r.setAttribute("alt",t.attributes.title),r.setAttribute("class","galleri-img"),r.setAttribute("data-src",t.meta.thumbnail),r.setAttribute("height",t.meta.thumbnailHeight),r.setAttribute("width",t.meta.thumbnailWidth),i.appendChild(r),a&&(o.setSrc(r),e.isLoggedIn()&&o.addAdminControls(l,t)),e.modifier("imageItem",{element:l,image:t}),l}static showCreateForm(){const t=document.createElement("form");t.setAttribute("action",`${window.GALLERI.args.apiPath}?type=images`),t.setAttribute("enctype","multipart/form-data"),t.setAttribute("id","galleri-image-form"),t.setAttribute("method","post"),t.addEventListener("submit",o.submitCreateFormCallback);const l=document.createElement("h2");l.setAttribute("class","galleri-heading"),l.innerText=window.GALLERI.lang.uploadImage,t.appendChild(l);const i=document.createElement("div");i.setAttribute("class","galleri-field"),i.setAttribute("id","galleri-field-upload"),t.appendChild(i);const r=document.createElement("label");r.setAttribute("class","galleri-label"),r.setAttribute("for","galleri-input-upload"),r.innerText=window.GALLERI.lang.fieldImageImages,i.appendChild(r);const n=document.createElement("div");n.setAttribute("class","galleri-file-container"),i.appendChild(n);const d=document.createElement("input");d.setAttribute("accept","image/*"),d.setAttribute("class","galleri-file-input"),d.setAttribute("id","galleri-input-upload"),d.setAttribute("name","upload[]"),d.setAttribute("multiple","multiple"),d.setAttribute("type","file"),d.addEventListener("change",o.onChange),n.appendChild(d);const s=document.createElement("div");s.setAttribute("class","galleri-file-text"),s.setAttribute("id","galleri-create-image-text"),s.innerText=window.GALLERI.lang.dragImagesOrClickHereToUpload,n.appendChild(s);const c=document.createElement("input");c.setAttribute("name","folder"),c.setAttribute("value",window.GALLERI.currentFolder.id),c.setAttribute("type","hidden"),t.appendChild(c),e.modifier("imageCreateForm",{addField:e.addField,form:t}),a.show(t,{append:!0,callback:o.submitCreateFormCallback,closeButtonAttributes:{form:"galleri-image-form",type:"submit"},closeButtonText:window.GALLERI.lang.upload,showCancel:!0})}static showEditForm(t){const l=t.target.closest("[data-path]").getAttribute("data-path");window.GALLERI.currentImage=window.GALLERI.currentImages[l];const i=document.createElement("form");i.setAttribute("action",`${window.GALLERI.args.apiPath}?type=images&id=${window.GALLERI.currentImage.id}`),i.setAttribute("id","galleri-image-form"),i.setAttribute("method","PUT"),i.addEventListener("submit",o.submitEditFormCallback);const r=document.createElement("h2");r.setAttribute("class","galleri-heading"),r.innerText=window.GALLERI.lang.titleEditImage,i.appendChild(r);const d=document.createElement("div");d.setAttribute("class","galleri-fields"),i.appendChild(d),e.addField(d,"filename",window.GALLERI.lang.fieldImageFilename);const s=e.addField(d,"folder",window.GALLERI.lang.fieldImageFolder,"select");n.addFolderOptions(s,window.GALLERI.currentImage.attributes.folder),e.addField(d,"title",window.GALLERI.lang.fieldImageTitle),Object.keys(window.GALLERI.currentImage.attributes).forEach((e=>{const t=i.querySelector(`#galleri-input-${e}`);t&&Object.prototype.hasOwnProperty.call(window.GALLERI.currentImage.attributes,e)&&t.setAttribute("value",window.GALLERI.currentImage.attributes[e])})),e.modifier("imageEditForm",{addField:e.addField,container:d,form:i}),a.show(i,{append:!0,callback:o.submitEditFormCallback,closeButtonAttributes:{form:"galleri-image-form",type:"submit"},closeButtonText:window.GALLERI.lang.save,showCancel:!0})}static delete(t){const l=t.target.closest("[data-path]").getAttribute("data-path");a.show(e.sprintf(window.GALLERI.lang.confirmDeleteImage,l),{closeButtonText:window.GALLERI.lang.delete,closeButtonClass:"galleri-button--danger",showCancel:!0,callback:()=>{o.deleteCallback(l),a.hide()}})}static deleteCallback(t){l.request({method:"DELETE",url:`${window.GALLERI.args.apiPath}?type=images&id=${t}`,callback:()=>{r.show(window.GALLERI.lang.deletedSuccessfullyImage,{class:"galleri-toast--success"}),o.removeImageFromList(t),e.callback("afterDeleteImage",{id:t})}})}static setThumbnail(e){e.target.getAttribute("data-current-thumbnail")?o.removeThumbnail(e):o.makeThumbnail(e)}static makeThumbnail(t){const a=t.target.closest("[data-path]").getAttribute("data-path"),i=window.GALLERI.currentImages[a],n=window.GALLERI.currentFolder.id,o={id:n,attributes:window.GALLERI.currentFolder.attributes};o.attributes.thumbnail=i.meta.thumbnail,l.request({method:"PUT",url:`${window.GALLERI.args.apiPath}?type=folders&id=${n}`,json:JSON.stringify(o),callback:()=>{r.show(window.GALLERI.lang.updatedSuccessfullyThumbnail,{class:"galleri-toast--success"});const a=document.querySelector("[data-current-thumbnail]");a&&(a.innerText=window.GALLERI.lang.makeThumbnail,a.removeAttribute("data-current-thumbnail")),t.target.innerText=window.GALLERI.lang.removeThumbnail,t.target.setAttribute("data-current-thumbnail",!0),e.callback("afterMakeThumbnail",{folderId:n,image:i})},errorCallback:()=>{r.show(window.GALLERI.lang.errorUpdatingThumbnail,{class:"galleri-toast--danger"})}})}static removeThumbnail(t){const a=t.target.closest("[data-path]").getAttribute("data-path"),i=window.GALLERI.currentImages[a],n=window.GALLERI.currentFolder.id,o={id:n,attributes:window.GALLERI.currentFolder.attributes};o.attributes.thumbnail="",l.request({method:"PUT",url:`${window.GALLERI.args.apiPath}?type=folders&id=${n}`,json:JSON.stringify(o),callback:()=>{r.show(window.GALLERI.lang.removedSuccessfullyThumbnail,{class:"galleri-toast--success"}),t.target.innerText=window.GALLERI.lang.makeThumbnail,t.target.removeAttribute("data-current-thumbnail"),e.callback("afterRemoveThumbnail",{folderId:n,image:i})},errorCallback:()=>{r.show(window.GALLERI.lang.errorRemovingThumbnail,{class:"galleri-toast--danger"})}})}static submitCreateFormCallback(e){e.preventDefault();const t=document.getElementById("galleri-image-form");i.clear(t);const a=document.getElementById("galleri-input-upload");if(a.files.length<=0)return void i.add(a,window.GALLERI.lang.validationRequired);const r=new FormData(t);l.request({method:t.getAttribute("method"),url:t.getAttribute("action"),formData:r,callback:e=>{o.createRequestCallback(e)},errorCallback:(e,t)=>{i.show(e,t)}})}static createRequestCallback(t){r.show(window.GALLERI.lang.createdSuccessfullyImage,{class:"galleri-toast--success"}),o.prependItems(t.data),window.GALLERI.grid&&window.GALLERI.grid.resizeAllItems(),t.data.forEach((e=>{window.GALLERI.currentImages[e.id]=e})),window.GALLERI.currentNumImages+=t.data.length,e.setNumImages(),document.getElementById("galleri-input-upload").value="",document.getElementById("galleri-create-image-text").innerText=window.GALLERI.lang.dragImagesOrClickHereToUpload;const a=document.getElementById("galleri-delete-folder");a&&(a.style.display="none"),e.callback("afterCreateImage",{image:t.data})}static submitEditFormCallback(e){e.preventDefault();const t=document.getElementById("galleri-image-form");i.clear(t);const n=document.getElementById("galleri-input-filename");if(!n.value)return void i.add(n,window.GALLERI.lang.validationRequired);const d=new FormData(t);let s={},c={};if(d.forEach(((e,t)=>{s[t]=e,Object.prototype.hasOwnProperty.call(window.GALLERI.currentImage.attributes,t)?c[t]=window.GALLERI.currentImage.attributes[t]:c[t]=""})),s=JSON.stringify(s),c=JSON.stringify(c),s===c)return a.hide(e),void r.show(window.GALLERI.lang.nothingToSave);l.request({method:t.getAttribute("method"),url:t.getAttribute("action"),json:s,callback:t=>{o.editRequestCallback(e,t)},errorCallback:(e,t)=>{i.show(e,t)}})}static editRequestCallback(t,l){document.getElementById("galleri-input-folder").value!==window.GALLERI.currentImage.attributes.folder?o.removeImageFromList(window.GALLERI.currentImage.id):o.updateImage(window.GALLERI.currentImage.id,l.data),delete window.GALLERI.currentImages[window.GALLERI.currentImage.id],window.GALLERI.currentImages[l.data.id]=l.data,window.GALLERI.currentImage=null,a.hide(t),r.show(window.GALLERI.lang.updatedSuccessfullyImage,{class:"galleri-toast--success"}),e.callback("afterEditImage",{image:l.data})}static appendItems(e){const t=e.map((e=>o.element(e)));window.GALLERI.elements.$imageList.append(...t)}static prependItems(e){e.forEach((e=>{window.GALLERI.elements.$imageList.prepend(o.element(e,!0))}))}static removeImageFromList(t){const a=document.querySelector(`[data-path="${t}"]`);let l;if(a.nextSibling&&(l=a.nextSibling.querySelector("button")),!l&&a.previousSibling&&(l=a.previousSibling.querySelector("button")),a.remove(),window.GALLERI.currentNumImages-=1,e.setNumImages(),o.hasImages())window.GALLERI.grid&&window.GALLERI.grid.resizeAllItems(),l&&l.focus();else if(!n.hasFolders()){const e=document.getElementById("galleri-delete-folder");e&&(e.style.display="")}}static onChange(t){const a=document.getElementById("galleri-image-form");i.clear(a);const l=[...t.target.files],r=window.GALLERI.args.maxFileSizeMegabytes,n=r?1e6*r:0,o=n?l.filter((e=>e.size>n)):[];if(o.length>0){const t=document.getElementById("galleri-input-upload");return o.forEach((a=>{i.add(t,e.sprintf(window.GALLERI.lang.errorFileSize,a.name,r))})),void(t.value=null)}const d=l.map((e=>e.name));document.getElementById("galleri-create-image-text").innerText=d.join(", ")}static updateImage(t,a){const l=document.querySelector(`[data-path="${t}"]`);l.setAttribute("data-path",a.id);l.querySelector(".galleri-link").setAttribute("href",a.meta.url);const i=l.querySelector(".galleri-img");a.attributes.title?i.setAttribute("alt",a.attributes.title):i.removeAttribute("alt"),e.callback("afterUpdateImage",{image:a,element:l})}static view(e){e.target.closest("[data-path]").querySelector(".galleri-link").click()}static getImages(){return document.querySelectorAll(`#galleri-images > ${window.GALLERI.args.imageItemElement}`)}static hasImages(){return o.getImages().length>0}static addAdminControls(e,t){if(e.querySelector(".galleri-admin"))return;const a=document.createElement("div");a.setAttribute("class","galleri-admin galleri-button-container"),e.appendChild(a);const l=document.createElement("button");l.setAttribute("class","galleri-button"),l.setAttribute("href","button"),l.innerText=window.GALLERI.lang.view,l.addEventListener("click",o.view),a.appendChild(l);const i=document.createElement("button");if(i.setAttribute("class","galleri-button galleri-button--secondary"),i.setAttribute("type","button"),i.innerText=window.GALLERI.lang.edit,i.addEventListener("click",o.showEditForm),a.appendChild(i),t.attributes.folder){const e=document.createElement("button");e.setAttribute("class","galleri-button galleri-button--secondary"),e.setAttribute("href","button"),e.setAttribute("data-thumbnail-button",!0),e.addEventListener("click",o.setThumbnail);const l=window.GALLERI.folders[t.attributes.folder];l&&l.attributes.thumbnail===t.meta.thumbnail?(e.setAttribute("data-current-thumbnail",!0),e.innerText=window.GALLERI.lang.removeThumbnail):e.innerText=window.GALLERI.lang.makeThumbnail,a.appendChild(e)}const r=document.createElement("button");if(r.setAttribute("class","galleri-button galleri-button--danger"),r.setAttribute("type","button"),r.innerText=window.GALLERI.lang.delete,r.addEventListener("click",o.delete),a.appendChild(r),window.GALLERI.args.removePointerEventsOnLogin){const t=e.querySelector(".galleri-link");t.style.pointerEvents="none",t.setAttribute("tabindex",-1)}}static onScroll(){const e=document.querySelectorAll("[data-src]"),t=window.innerHeight,a=window.scrollY+t+t;e.forEach((e=>{e.getBoundingClientRect().top<=a&&o.setSrc(e)}))}static setSrc(t){const a=t.getAttribute("data-src");t.setAttribute("src",a),t.removeAttribute("data-src"),t.closest(".galleri-link").style.backgroundImage=`url("${a}")`,e.callback("afterLoadImage",{element:t})}}class d{static init(){window.GALLERI.elements.$authenticateButton&&(window.GALLERI.elements.$authenticateButton.addEventListener("click",(()=>{d.authenticate()})),d.handleAuthentication())}static authenticate(){e.isLoggedIn()?d.logout():d.login()}static logout(){if(window.navigator.userAgent.indexOf("Safari")>-1)return void d.logoutCallback();const e=[window.location.protocol,"//log:out@",window.location.host,`${window.GALLERI.args.apiPath}?type=sessions`].join("");l.request({method:"DELETE",url:e,noParse:!0,callback:()=>{d.logoutCallback()},errorCallback:()=>{d.logoutCallback()}})}static logoutCallback(){window.localStorage.clear(),d.handleLogout()}static login(){l.request({method:"POST",url:`${window.GALLERI.args.apiPath}?type=sessions`,noParse:!0,callback:(e,t)=>{204===t?(window.localStorage.setItem(window.GALLERI.args.localStorageKey,!0),this.handleLogin()):a.show(window.GALLERI.lang.error+window.GALLERI.lang.errorInvalidUsername)}})}static handleAuthentication(){e.isLoggedIn()?d.handleLogin():d.handleLogout()}static handleLogin(){window.GALLERI.elements.$authenticateButton.innerText=window.GALLERI.lang.logOut,document.body.classList.add("galleri-is-admin"),d.addAdminBar(),o.getImages().forEach((e=>{const t=e.getAttribute("data-path");o.addAdminControls(e,window.GALLERI.currentImages[t])})),e.callback("afterLogin")}static handleLogout(){window.GALLERI.elements.$authenticateButton.innerText=window.GALLERI.lang.logIn,document.body.classList.remove("galleri-is-admin");let t=document.querySelectorAll(".galleri-admin");t.forEach((e=>{e.remove()})),window.GALLERI.args.removePointerEventsOnLogin&&(t=document.querySelectorAll(".galleri-link"),t.forEach((e=>{e.removeAttribute("tabindex"),e.style.pointerEvents=""}))),e.callback("afterLogout")}static addAdminBar(){const t=document.createElement("div");t.setAttribute("id","galleri-admin"),t.setAttribute("class","galleri-admin"),window.GALLERI.elements.$container.prepend(t);const a=document.createElement("div");a.setAttribute("class","galleri-button-container"),a.setAttribute("id","galleri-admin-buttons"),t.prepend(a);const l=document.createElement("div");l.setAttribute("aria-live","polite"),l.setAttribute("class","galleri-toast-container"),l.setAttribute("id","galleri-toast-container"),l.setAttribute("role","alert"),t.prepend(l);const i=document.createElement("button");i.setAttribute("class","galleri-button"),i.setAttribute("id","galleri-create-image"),i.setAttribute("type","button"),i.innerText=window.GALLERI.lang.uploadImage,i.addEventListener("click",o.showCreateForm),a.append(i);const r=document.createElement("button");if(r.setAttribute("class","galleri-button galleri-button--secondary"),r.setAttribute("id","galleri-create-folder"),r.setAttribute("type","button"),r.innerText=window.GALLERI.lang.createFolder,r.addEventListener("click",n.showCreateForm),a.append(r),window.GALLERI.currentFolder.id){const t=document.createElement("button");t.setAttribute("class","galleri-button galleri-button--secondary"),t.setAttribute("id","galleri-edit-folder"),t.setAttribute("type","button"),t.innerText=window.GALLERI.lang.editFolder,t.addEventListener("click",n.showEditForm),a.append(t);const l=document.createElement("button");l.setAttribute("class","galleri-button galleri-button--danger"),l.setAttribute("id","galleri-delete-folder"),l.setAttribute("type","button"),l.innerText=window.GALLERI.lang.deleteFolder,e.isEmpty()||(l.style.display="none"),l.addEventListener("click",n.delete),a.append(l)}e.modifier("adminBar",{element:a})}}class s{constructor(){window.GALLERI.elements.$imageList.classList.add("galleri-grid"),this.calculate(),window.addEventListener("resize",e.debounce((()=>{this.calculate(),this.resizeAllItems()}),100))}calculate(){const e=window.getComputedStyle(window.GALLERI.elements.$imageList);this.gridRowHeight=parseInt(e.getPropertyValue("grid-auto-rows"),10),this.gridRowGap=parseInt(e.getPropertyValue("grid-row-gap"),10)}checkResizeItem(e){const t=e.querySelector("img");this.resizeItem(e,t),t.onload=()=>{this.resizeItem(e,t);e.querySelector("a").classList.add("galleri-show")}}resizeItem(e,t){const a=t.getBoundingClientRect().height,l=Math.ceil((a+this.gridRowGap)/(this.gridRowHeight+this.gridRowGap));e.style.gridRowEnd=`span ${l}`}resizeAllItems(){[...document.getElementsByClassName("galleri-figure")].forEach((e=>{this.checkResizeItem(e)}))}}class c{constructor(t){(t=t||{}).apiFoldersPath=t.apiFoldersPath||"/json/folders.json",t.apiImagesPath=t.apiImagesPath||"/json/images.json",t.apiPath=t.apiPath||"/api.php",t.callbacks=t.callbacks||{},t.enableGrid=!e.propertyExists(t,"enableGrid")||t.enableGrid,t.enableRewrites=!e.propertyExists(t,"enableRewrites")||t.enableRewrites,t.folderItemElement=t.folderItemElement||"li",t.folderSeparator=t.folderSeparator||" > ",t.imageItemElement=t.imageItemElement||"figure",t.localStorageKey=t.localStorageKey||"authenticated",t.maxFileSizeMegabytes=t.maxFileSizeMegabytes||null,t.metaTitleSeparator=t.metaTitleSeparator||" | ",t.modifiers=t.modifiers||{},t.pageSize=t.pageSize||8,t.removePointerEventsOnLogin=!e.propertyExists(t,"removePointerEventsOnLogin")||t.removePointerEventsOnLogin,t.selector=t.selector||"#galleri",t.showAllImages=!!e.propertyExists(t,"showAllImages")&&t.showAllImages,this.args=t;const a=document.querySelector(t.selector);if(!a)return;const l=t.lang||{};l.cancel=l.cancel||"Cancel",l.close=l.close||"Close",l.confirmDeleteFolder=l.confirmDeleteFolder||'Are you sure you want to delete the folder "%s"?',l.confirmDeleteImage=l.confirmDeleteImage||'Are you sure you want to delete the image "%s"?',l.createdSuccessfullyImage=l.createdSuccessfullyImage||"Image uploaded successfully.",l.createdSuccessfullyFolder=l.createdSuccessfullyFolder||"Folder created successfully.",l.createFolder=l.createFolder||"Create Folder",l.delete=l.delete||"Delete",l.deletedSuccessfullyImage=l.deletedSuccessfullyImage||"Image deleted successfully.",l.deletedSuccessfullyFolder=l.deletedSuccessfullyFolder||"Folder deleted successfully.",l.deleteFolder=l.deleteFolder||"Delete Folder",l.dragImagesOrClickHereToUpload=l.dragImagesOrClickHereToUpload||"Drag images or click here to upload.",l.edit=l.edit||"Edit",l.editFolder=l.editFolder||"Edit Folder",l.error=l.error||"Error: ",l.errorFileSize=l.errorFileSize||"%s is too large. (Maximum size is %s MB.)",l.errorFolderDoesNotExist=l.errorFolderDoesNotExist||"This folder does not exist.",l.errorInvalidUsername=l.errorInvalidUsername||"Invalid username or password.",l.errorUpdatingThumbnail=l.errorUpdatingThumbnail||"Error updating thumbnail.",l.errorRemovingThumbnail=l.errorRemovingThumbnail||"Error removing thumbnail.",l.errorStatus=l.errorStatus||"The server returned a %s error.",l.fieldFolderId=l.fieldFolderId||"ID",l.fieldFolderName=l.fieldFolderName||"Name",l.fieldFolderParent=l.fieldFolderParent||"Parent",l.fieldFolderThumbnail=l.fieldFolderThumbnail||"Thumbnail",l.fieldImageImages=l.fieldImageImages||"Images",l.fieldImageFilename=l.fieldImageFilename||"Filename",l.fieldImageTitle=l.fieldImageTitle||"Title",l.fieldImageFolder=l.fieldImageFolder||"Folder",l.home=l.home||"Home",l.loading=l.loading||"Loading...",l.logIn=l.logIn||"Log In",l.logOut=l.logOut||"Log Out",l.makeThumbnail=l.makeThumbnail||"Make Thumbnail",l.nothingToSave=l.nothingToSave||"Nothing to save.",l.ok=l.ok||"OK",l.pluralImageText=l.pluralImageText||"images",l.removeThumbnail=l.removeThumbnail||"Remove Thumbnail",l.removedSuccessfullyThumbnail=l.removedSuccessfullyThumbnail||"Thumbnail removed successfully.",l.save=l.save||"Save",l.singularImageText=l.singularImageText||"image",l.submitCreateFolder=l.submitCreateFolder||"Create",l.submitEditFolder=l.submitEditFolder||"Save",l.titleCreateFolder=l.titleCreateFolder||"Create Folder",l.titleEditFolder=l.titleEditFolder||"Edit Folder",l.titleEditImage=l.titleEditImage||"Edit Image",l.updatedSuccessfullyImage=l.updatedSuccessfullyImage||"Image updated successfully.",l.updatedSuccessfullyFolder=l.updatedSuccessfullyFolder||"Folder updated successfully.",l.updatedSuccessfullyThumbnail=l.updatedSuccessfullyThumbnail||"Thumbnail updated successfully.",l.upload=l.upload||"Upload",l.uploadImage=l.uploadImage||"Upload Image",l.validationRequired=l.validationRequired||"Error: This field is required.",l.view=l.view||"View",this.lang=l;const i=document.createElement("ul");i.setAttribute("id","galleri-folders"),a.appendChild(i);const r=document.createElement("div");r.setAttribute("id","galleri-images"),a.appendChild(r),this.elements={$authenticateButton:document.querySelector('[data-action="authenticate"]'),$container:a,$folderList:i,$imageList:r},this.state={isLoadingFolder:!1,isLoadingImages:!1,numRequestsInProgress:0},this.currentFolder=null,this.currentImage=null,this.currentImages={},this.currentNumImages=null,this.folders=[]}static init(a){if(!e.propertyExists(window,"GALLERI")){if(window.GALLERI=new c(a),!window.GALLERI.elements.$imageList)return null;n.load(),o.load(),t.init(document.body,"galleri-spinner"),a.enableGrid&&(window.GALLERI.grid=new s);let l=setInterval((()=>{window.GALLERI.state.isLoadingFolder||window.GALLERI.state.isLoadingImages||(d.init(),e.setNumImages(),clearInterval(l),l=null)}),250)}return window.GALLERI}}window.galleri=c}();