var Galleri;(()=>{"use strict";var e={d:(t,a)=>{for(var l in a)e.o(a,l)&&!e.o(t,l)&&Object.defineProperty(t,l,{enumerable:!0,get:a[l]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{e.r(t),e.d(t,{default:()=>m});class a{static addField(e,t,a,l="text"){const r=document.createElement("div");r.setAttribute("class",`galleri-field galleri-field--${l}`),r.setAttribute("id",`galleri-field-${t}`),e.appendChild(r);const i=document.createElement("label");let n;return i.setAttribute("class","galleri-label"),i.setAttribute("for",`galleri-input-${t}`),i.innerText=a,r.appendChild(i),"select"===l?(n=document.createElement("select"),n.setAttribute("class","galleri-select")):(n=document.createElement("input"),n.setAttribute("class","galleri-input"),n.setAttribute("type",l)),n.setAttribute("id",`galleri-input-${t}`),n.setAttribute("name",t),r.appendChild(n),n}static callback(e,t){window.GALLERI.args.callbacks[e]&&window.GALLERI.args.callbacks[e](t)}static debounce(e,t,a){let l;return function(...r){const i=this,n=a&&!l;clearTimeout(l),l=setTimeout((()=>{l=null,a||e.apply(i,r)}),t),n&&e.apply(i,r)}}static isEmpty(){const e=window.getComputedStyle(window.GALLERI.elements.$imageList),t=window.getComputedStyle(window.GALLERI.elements.$folderList);return"none"===e.display&&"none"===t.display}static isLoggedIn(){return window.localStorage.getItem(window.GALLERI.args.localStorageKey)}static modifier(e,t){window.GALLERI.args.modifiers[e]&&window.GALLERI.args.modifiers[e](t)}static propertyExists(e,t){return Object.prototype.hasOwnProperty.call(e,t)}static setMetaTitle(e){const t=document.querySelector("title");t.innerText=e+window.GALLERI.args.metaTitleSeparator+t.innerText}static setPageTitle(e){let t=document.getElementById("galleri-folder-title-text");if(!t){const l=document.createElement("h1");l.setAttribute("id","galleri-folder-title"),window.GALLERI.elements.$container.prepend(l),t=document.createElement("span"),t.setAttribute("id","galleri-folder-title-text"),l.appendChild(t),window.GALLERI.elements.$numImages=document.createElement("small"),window.GALLERI.elements.$numImages.setAttribute("id","galleri-folder-num"),l.appendChild(window.GALLERI.elements.$numImages),a.modifier("title",{element:l,title:e})}t.innerText=e}static setNumImages(){const e=1===window.GALLERI.currentNumImages?window.GALLERI.lang.singularImageText:window.GALLERI.lang.pluralImageText;window.GALLERI.elements.$numImages.innerText=`(${window.GALLERI.currentNumImages.toLocaleString()} ${e})`}static sprintf(e,...t){return t.forEach((t=>{e=e.replace("%s",t)})),e}static toSlug(e){return e?e.toLowerCase().replace(/ & /g,"-and-").replace(/<[^>]+>/g,"").replace(/['â€™.]/g,"").replace(/[^a-z0-9-]+/g,"-").replace(/^-+/,"").replace(/-+$/,"").replace(/--+/g,"-"):""}}class l{static show(e,t={}){t.closeButtonText=t.closeButtonText||window.GALLERI.lang.ok,t.closeButtonClass=t.closeButtonClass||"",document.body.classList.add("galleri-modal-open");const r=`galleri-modal-${(new Date).getTime()}`,i=document.createElement("dialog");i.setAttribute("id",r),i.setAttribute("class","galleri-modal");const n=document.createElement("div");if(n.setAttribute("class","galleri-modal-box"),i.appendChild(n),t.append)n.appendChild(e);else{const t=document.createElement("p");t.setAttribute("class","galleri-modal-text"),t.innerText=e,n.appendChild(t)}let o;if(!t.hideClose||t.showCancel){const e=document.createElement("p");if(e.setAttribute("class","galleri-modal-options"),n.appendChild(e),!t.hideClose){const r=e=>{a.propertyExists(t,"callback")?t.callback(e):l.hide(e)};o=document.createElement("button"),o.setAttribute("id","galleri-modal-close"),o.setAttribute("type","button"),o.setAttribute("class",`galleri-button ${t.closeButtonClass}`.trim()),o.setAttribute("data-galleri-modal-close",""),t.closeButtonAttributes&&Object.keys(t.closeButtonAttributes).forEach((e=>{o.setAttribute(e,t.closeButtonAttributes[e])})),o.innerText=t.closeButtonText,o.addEventListener("click",r),e.appendChild(o),document.addEventListener("keydown",l.keydownListener,!1)}if(t.showCancel){const t=document.createElement("button");t.setAttribute("id","galleri-modal-cancel"),t.setAttribute("type","button"),t.setAttribute("class","galleri-button galleri-button--secondary"),t.innerText=window.GALLERI.lang.cancel,t.addEventListener("click",this.hide),e.appendChild(t)}}return document.body.appendChild(i),window.GALLERI.activeElement=document.activeElement,i.showModal(),o?o.focus():i.focus(),a.modifier("modal",{element:i}),i}static keydownListener(e){"Escape"===e.key&&(l.hide(),document.removeEventListener("keydown",l.keydownListener))}static hide(e){let t;document.body.classList.remove("galleri-modal-open"),t=e&&e.target?e.target:document.querySelector("[data-galleri-modal-close]"),t.closest(".galleri-modal").remove(),window.GALLERI.activeElement&&(window.GALLERI.activeElement.focus(),window.GALLERI.activeElement=null)}}class r{static show(){let e=document.querySelector(".galleri-spinner");return e||(e=document.createElement("div"),e.setAttribute("class","galleri-spinner"),e.setAttribute("role","alert"),e.innerText=window.GALLERI.lang.loading,document.body.appendChild(e)),e.style.display="",a.modifier("spinner",{element:e}),e}static hide(e){e.style.display="none"}}class i{static request(e){(e=e||{}).method=e.method||"GET";const t=r.show();window.GALLERI.state.numRequestsInProgress+=1;const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(l.readyState!==XMLHttpRequest.DONE)return;window.GALLERI.state.numRequestsInProgress-=1,window.GALLERI.state.numRequestsInProgress<=0&&r.hide(t);let a=l.responseText;if(a||!(l.status<200||l.status>299)){if(a&&!e.noParse)try{a=JSON.parse(a)}catch(t){return void i.error(e,a,l)}l.status<200||l.status>299?i.error(e,a,l):e.callback(a,l.status)}else i.error(e,a,l)};let n=e.url;e.url.endsWith(".json")&&a.isLoggedIn()&&(n+=`?t=${Date.now()}`),l.open(e.method,n,!0),e.json?(l.setRequestHeader("Content-Type","application/json"),l.send(e.json)):l.send(e.formData)}static error(e,t,r){e.errorCallback?e.errorCallback(t,r.status):l.show(a.sprintf(window.GALLERI.lang.error+window.GALLERI.lang.errorStatus,r.status))}}class n{static add(e,t){e.setAttribute("aria-invalid",!0);const a=e.closest(".galleri-field");a.classList.add("galleri-has-error");const l=document.createElement("span");l.setAttribute("class","galleri-error"),l.setAttribute("id",`galleri-error-${e.getAttribute("id")}`),l.innerText=t,a.append(l)}static clear(e){let t=e.querySelectorAll(".galleri-error");t.forEach((e=>{e.remove()})),t=e.querySelectorAll(".galleri-has-error"),t.forEach((e=>{e.classList.remove("galleri-has-error"),e.removeAttribute("aria-invalid")}))}static show(e,t){if(e.errors){const r=[];e.errors.forEach((e=>{if(e.pointer){const t=document.getElementById(`galleri-input-${e.pointer}`);t?n.add(t,window.GALLERI.lang.error+e.title):r.push(e.title)}else r.push(e.title)})),r.length>0&&l.show(a.sprintf(window.GALLERI.lang.error+r.join(" "),t))}else l.show(a.sprintf(window.GALLERI.lang.error+window.GALLERI.lang.errorStatus,t))}}class o{static show(e,t={}){t.class=t.class||"",t.closeButtonClass=t.closeButtonText||"",t.closeButtonText=t.closeButtonText||window.GALLERI.lang.close,t.duration=t.duration||3e3;let l=document.getElementById("galleri-toast-container");l||(l=document.createElement("div"),l.setAttribute("id","galleri-toast-container"),document.getElementById("galleri-admin").append(l));const r=`galleri-toast-${(new Date).getTime()}`,i=document.createElement("div");i.setAttribute("class",`galleri-toast ${t.class}`.trim()),i.setAttribute("id",r),i.setAttribute("role","alert"),i.style.animationDuration=`${t.duration}ms`,l.appendChild(i);const n=document.createElement("p");if(n.setAttribute("class","galleri-toast-text"),n.innerText=e,i.appendChild(n),!t.hideClose){const e=e=>{o.hide(e)},a=document.createElement("button");a.setAttribute("class",`galleri-toast-close ${t.closeButtonClass}`.trim()),a.setAttribute("type","button"),t.closeButtonAttributes&&Object.keys(t.closeButtonAttributes).forEach((e=>{a.setAttribute(e,t.closeButtonAttributes[e])})),a.innerText=t.closeButtonText,a.addEventListener("click",e),i.appendChild(a)}return a.modifier("toast",{element:i}),setTimeout((()=>{i.remove()}),t.duration+1e3),i}static hide(e){e.target.closest(".galleri-toast").remove()}}class d{static load(){window.GALLERI.state.isLoadingFolder=!0,i.request({url:window.GALLERI.args.apiFoldersPath,callback:e=>{e?d.loadFolderCallback(e):i.request({url:`${window.GALLERI.args.apiPath}?type=folders`,callback:e=>{d.loadFolderCallback(e)}})},errorCallback:()=>{i.request({url:`${window.GALLERI.args.apiPath}?type=folders`,callback:e=>{d.loadFolderCallback(e)}})}})}static getCurrentFolderId(){return window.GALLERI.args.enableRewrites?window.location.pathname.replace(/^\/+/,""):new URLSearchParams(window.location.search).get("folder")||""}static loadFolderCallback(e){const t=d.getCurrentFolderId();let r,i;if(window.GALLERI.folders=e.data,r=""===t?{id:"",type:"folders",attributes:{name:""}}:window.GALLERI.folders[t],r){if(window.GALLERI.currentFolder=r,""!==window.GALLERI.currentFolder.id&&d.initBreadcrumb(),r.attributes.name&&a.setMetaTitle(r.attributes.name),a.setPageTitle(r.attributes.name?r.attributes.name:window.GALLERI.lang.home),""===window.GALLERI.currentFolder.id)i=Object.values(window.GALLERI.folders).filter((e=>!e.id.includes("/")));else{const e=window.GALLERI.currentFolder.id.split("/").length+1;i=Object.values(window.GALLERI.folders).filter((t=>!!t.id.startsWith(`${window.GALLERI.currentFolder.id}/`)&&e===t.id.split("/").length))}i.length>0&&d.appendItems(i),window.GALLERI.state.isLoadingFolder=!1,a.callback("afterLoadFolder",{folder:r})}else l.show(window.GALLERI.lang.error+window.GALLERI.lang.errorFolderDoesNotExist)}static url(e){return window.GALLERI.args.enableRewrites?`/${e.id}`:`/?folder=${e.id}`}static element(e){const t=document.createElement(window.GALLERI.args.folderItemElement);t.setAttribute("class","galleri-folder"),t.setAttribute("data-path",e.id);const l=document.createElement("a");if(l.setAttribute("class","galleri-folder-link"),l.setAttribute("href",d.url(e)),t.appendChild(l),e.attributes.thumbnail){const t=document.createElement("img");t.setAttribute("class","galleri-folder-img"),t.setAttribute("src",e.attributes.thumbnail),l.appendChild(t)}const r=document.createElement("div");return r.setAttribute("class","galleri-folder-name"),r.innerText=e.attributes.name,l.appendChild(r),a.modifier("folderItem",{element:t,folder:e}),t}static showCreateForm(){const e=d.form(window.GALLERI.lang.titleCreateFolder,"post",d.submitCreateFormCallback),t=e.querySelector("#galleri-input-parent");t&&d.addFolderOptions(t,window.GALLERI.currentFolder.id);const r=e.querySelector("#galleri-field-parent");Object.keys(window.GALLERI.folders).length<=0?r.style.display="none":r.style.display="",a.modifier("folderCreateForm",{addField:a.addField,form:e}),l.show(e,{append:!0,callback:d.submitCreateFormCallback,closeButtonAttributes:{form:"galleri-folder-form",type:"submit"},closeButtonText:window.GALLERI.lang.save,showCancel:!0})}static showEditForm(){const e=d.form(window.GALLERI.lang.titleEditFolder,"put",d.submitEditFormCallback,window.GALLERI.currentFolder.id),t=e.querySelector("#galleri-input-parent");t&&d.addFolderOptions(t,d.getParentId(window.GALLERI.currentFolder.id));const r=e.querySelector("#galleri-field-parent");Object.keys(window.GALLERI.folders).length<=0?r.style.display="none":r.style.display="";const i=e.querySelector("#galleri-input-id");i&&(i.value=window.GALLERI.currentFolder.id.replace(/^.+\/([^/]+)$/,"$1")),Object.keys(window.GALLERI.currentFolder.attributes).forEach((t=>{const a=e.querySelector(`#galleri-input-${t}`);a&&a.setAttribute("value",window.GALLERI.currentFolder.attributes[t])})),a.modifier("folderEditForm",{addField:a.addField,form:e}),l.show(e,{append:!0,callback:d.submitEditFormCallback,closeButtonAttributes:{form:"galleri-folder-form",type:"submit"},closeButtonText:window.GALLERI.lang.save,showCancel:!0})}static form(e,t,l,r=""){const i=document.createElement("form");let n=`${window.GALLERI.args.apiPath}?type=folders`;r&&(n+=`&id=${r}`),i.setAttribute("action",n),i.setAttribute("id","galleri-folder-form"),i.setAttribute("method",t),i.addEventListener("submit",l);const o=document.createElement("h2");o.setAttribute("class","galleri-heading"),o.innerText=e,i.appendChild(o);const d=document.createElement("div");d.setAttribute("class","galleri-fields"),i.appendChild(d);const s=a.addField(d,"name",window.GALLERI.lang.fieldFolderName),c=a.addField(d,"id",window.GALLERI.lang.fieldFolderId);return a.addField(d,"parent",window.GALLERI.lang.fieldFolderParent,"select"),a.addField(d,"thumbnail",window.GALLERI.lang.fieldFolderThumbnail),s.addEventListener("keyup",(e=>{c.value=a.toSlug(e.target.value)})),s.addEventListener("change",(e=>{c.value=a.toSlug(e.target.value)})),a.modifier("folderForm",{addField:a.addField,container:d,form:i}),i}static delete(){const e=window.GALLERI.currentFolder.id;l.show(a.sprintf(window.GALLERI.lang.confirmDeleteFolder,window.GALLERI.currentFolder.attributes.name),{closeButtonText:window.GALLERI.lang.delete,closeButtonClass:"galleri-button--danger",showCancel:!0,callback:()=>{d.deleteCallback(e),l.hide()}})}static deleteCallback(e){i.request({method:"DELETE",url:`${window.GALLERI.args.apiPath}?type=folders&id=${e}`,callback:()=>{a.callback("afterDeleteFolder",{id:e});const t=d.getParentId(window.GALLERI.currentFolder.id);window.location=window.location.href.replace(d.url(window.GALLERI.currentFolder),t?d.url(window.GALLERI.folders[t]):"")}})}static submitCreateFormCallback(e){e.preventDefault();const t=document.getElementById("galleri-folder-form");n.clear(t);const a=document.getElementById("galleri-input-name");if(!a.value)return void n.add(a,window.GALLERI.lang.validationRequired);const l=document.getElementById("galleri-input-id");if(!l.value)return void n.add(l,window.GALLERI.lang.validationRequired);const r=new FormData(t);let o={id:null,attributes:{}};r.forEach(((e,t)=>{"id"===t?o[t]=e:o.attributes[t]=e})),o=JSON.stringify(o),i.request({method:t.getAttribute("method"),url:t.getAttribute("action"),json:o,callback:e=>{d.createRequestCallback(e)},errorCallback:(e,t)=>{n.show(e,t)}})}static createRequestCallback(e){o.show(window.GALLERI.lang.createdSuccessfullyFolder,{class:"galleri-toast--success"});const t=d.getParentId(e.data.id);if(t&&t===window.GALLERI.currentFolder.id||!t&&!window.GALLERI.currentFolder.id){d.addToList(e.data);const t=document.getElementById("galleri-delete-folder");t&&(t.style.display="none")}document.getElementById("galleri-input-name").value="",document.getElementById("galleri-input-id").value="",window.GALLERI.folders[e.data.id]=e.data;const l=document.getElementById("galleri-input-parent");d.addFolderOptions(l,l.value),document.getElementById("galleri-field-parent").style.display="",a.callback("afterCreateFolder",{folder:e.data})}static submitEditFormCallback(e){e.preventDefault();const t=document.getElementById("galleri-folder-form");n.clear(t);const a=document.getElementById("galleri-input-name");if(!a.value)return void n.add(a,window.GALLERI.lang.validationRequired);const r=document.getElementById("galleri-input-id");if(!r.value)return void n.add(r,window.GALLERI.lang.validationRequired);const s=new FormData(t);let c={attributes:{}},u={attributes:{}};if(s.forEach(((e,t)=>{"id"===t?(c[t]=e,Object.prototype.hasOwnProperty.call(window.GALLERI.currentFolder,t)?u[t]=window.GALLERI.currentFolder[t].replace(/^.+\/([^/]+)$/,"$1"):u[t]=""):(c.attributes[t]=e,Object.prototype.hasOwnProperty.call(window.GALLERI.currentFolder.attributes,t)?u.attributes[t]=window.GALLERI.currentFolder.attributes[t]:u.attributes[t]="")})),c=JSON.stringify(c),u=JSON.stringify(u),c===u)return o.show(window.GALLERI.lang.nothingToSave),void l.hide(e);i.request({method:t.getAttribute("method"),url:t.getAttribute("action"),json:c,callback:e=>{d.editRequestCallback(e)},errorCallback:(e,t)=>{n.show(e,t)}})}static editRequestCallback(e){a.callback("afterEditFolder",{folder:e.data}),window.location=window.location.href.replace(d.url(window.GALLERI.currentFolder),d.url(e.data))}static appendItems(e){e.forEach((e=>{window.GALLERI.elements.$folderList.appendChild(d.element(e))}))}static addToList(e){let t;const a=window.GALLERI.elements.$folderList.children,l=a.length;let r;for(t=0;t<l&&a[t].getAttribute("data-path")<e.id;t+=1)r=a[t];r?r.after(d.element(e)):window.GALLERI.elements.$folderList.prepend(d.element(e))}static getFullName(e){const t=[e.attributes.name];let a=d.getParentId(e.id);for(;a&&window.GALLERI.folders[a];)e=window.GALLERI.folders[a],t.push(e.attributes.name),a=d.getParentId(e.id);return t.reverse().join(window.GALLERI.args.folderSeparator)}static getParentId(e){const t=e.lastIndexOf("/");return-1===t?"":e.substr(0,t)}static getFolders(){return document.querySelectorAll(`#galleri-folders > ${window.GALLERI.args.folderItemElement}`)}static hasFolders(){return d.getFolders().length>0}static addFolderOptions(e,t){e.innerText="";let a,l=document.createElement("option");l.setAttribute("value",""),e.appendChild(l),Object.keys(window.GALLERI.folders).sort().forEach((r=>{a=window.GALLERI.folders[r],l=document.createElement("option"),l.setAttribute("value",a.id),l.innerText=d.getFullName(window.GALLERI.folders[a.id]),a.id===t&&l.setAttribute("selected","selected"),e.appendChild(l)}))}static initBreadcrumb(){const e=document.createElement("ul");e.setAttribute("class","galleri-breadcrumb"),window.GALLERI.elements.$container.prepend(e);let t=window.GALLERI.currentFolder;do{e.prepend(this.breadcrumbItem(t)),t=window.GALLERI.folders[d.getParentId(t.id)]}while(t);e.prepend(this.breadcrumbItem({id:"",attributes:{name:window.GALLERI.lang.home}})),a.modifier("breadcrumbList",{element:e,folder:window.GALLERI.currentFolder})}static breadcrumbItem(e){const t=document.createElement("li");if(t.setAttribute("class","galleri-breadcrumb-item"),e.id===window.GALLERI.currentFolder.id)t.innerText=e.attributes.name;else{const a=document.createElement("a");a.setAttribute("class","galleri-breadcrumb-link"),a.setAttribute("href",e.id?d.url(e):"/"),a.innerText=e.attributes.name,t.prepend(a)}return a.modifier("breadcrumbItem",{element:t,folder:e}),t}}class s{static load(){window.GALLERI.state.isLoadingImages=!0,i.request({url:window.GALLERI.args.apiImagesPath,callback:e=>{e?s.getImagesCallback(e):i.request({url:`${window.GALLERI.args.apiPath}?type=images`,callback:e=>{s.getImagesCallback(e)}})},errorCallback:()=>{i.request({url:`${window.GALLERI.args.apiPath}?type=images`,callback:e=>{s.getImagesCallback(e)}})}})}static getImagesCallback(e){const t=d.getCurrentFolderId();let l=Object.values(e.data);if(window.GALLERI.args.showAllImages||(l=l.filter((e=>e.attributes.folder===t))),a.modifier("images",{images:l}),l.forEach((e=>{window.GALLERI.currentImages[e.id]=e})),s.appendItems(l),window.GALLERI.grid&&window.GALLERI.grid.resizeAllItems(),window.GALLERI.state.allPagesLoaded=!0,window.GALLERI.currentNumImages=l.length,l.length<=0){if(!d.hasFolders()){const e=document.getElementById("galleri-delete-folder");e&&(e.style.display="")}}else{const e=document.getElementById("galleri-delete-folder");e&&(e.style.display="none")}window.GALLERI.state.isLoadingImages=!1,s.onScroll(),window.addEventListener("scroll",a.debounce((()=>{s.onScroll()}),100)),a.callback("afterLoadImages",{images:l})}static element(e,t=!1){const l=document.createElement(window.GALLERI.args.imageItemElement);l.setAttribute("class","galleri-figure"),l.setAttribute("data-path",e.id);const r=document.createElement("a");r.setAttribute("class","galleri-link"),r.setAttribute("href",e.meta.url),l.appendChild(r);const i=document.createElement("img");return e.attributes.title&&i.setAttribute("alt",e.attributes.title),i.setAttribute("class","galleri-img"),i.setAttribute("data-src",e.meta.thumbnail),i.setAttribute("height",e.meta.thumbnailHeight),i.setAttribute("width",e.meta.thumbnailWidth),r.appendChild(i),t&&(s.setSrc(i),a.isLoggedIn()&&s.addAdminControls(l,e)),a.modifier("imageItem",{element:l,image:e}),l}static showCreateForm(){const e=document.createElement("form");e.setAttribute("action",`${window.GALLERI.args.apiPath}?type=images`),e.setAttribute("enctype","multipart/form-data"),e.setAttribute("id","galleri-image-form"),e.setAttribute("method","post"),e.addEventListener("submit",s.submitCreateFormCallback);const t=document.createElement("h2");t.setAttribute("class","galleri-heading"),t.innerText=window.GALLERI.lang.uploadImage,e.appendChild(t);const r=document.createElement("div");r.setAttribute("class","galleri-field"),r.setAttribute("id","galleri-field-upload"),e.appendChild(r);const i=document.createElement("label");i.setAttribute("class","galleri-label"),i.setAttribute("for","galleri-input-upload"),i.innerText=window.GALLERI.lang.fieldImageImages,r.appendChild(i);const n=document.createElement("div");n.setAttribute("class","galleri-file-container"),r.appendChild(n);const o=document.createElement("input");o.setAttribute("accept","image/*"),o.setAttribute("class","galleri-file-input"),o.setAttribute("id","galleri-input-upload"),o.setAttribute("name","upload[]"),o.setAttribute("multiple","multiple"),o.setAttribute("type","file"),o.addEventListener("change",s.onChange),n.appendChild(o);const d=document.createElement("div");d.setAttribute("class","galleri-file-text"),d.setAttribute("id","galleri-create-image-text"),d.innerText=window.GALLERI.lang.dragImagesOrClickHereToUpload,n.appendChild(d);const c=document.createElement("input");c.setAttribute("name","folder"),c.setAttribute("value",window.GALLERI.currentFolder.id),c.setAttribute("type","hidden"),e.appendChild(c),a.modifier("imageCreateForm",{addField:a.addField,form:e}),l.show(e,{append:!0,callback:s.submitCreateFormCallback,closeButtonAttributes:{form:"galleri-image-form",type:"submit"},closeButtonText:window.GALLERI.lang.upload,showCancel:!0})}static showEditForm(e){const t=e.target.closest("[data-path]").getAttribute("data-path");window.GALLERI.currentImage=window.GALLERI.currentImages[t];const r=document.createElement("form");r.setAttribute("action",`${window.GALLERI.args.apiPath}?type=images&id=${window.GALLERI.currentImage.id}`),r.setAttribute("id","galleri-image-form"),r.setAttribute("method","PUT"),r.addEventListener("submit",s.submitEditFormCallback);const i=document.createElement("h2");i.setAttribute("class","galleri-heading"),i.innerText=window.GALLERI.lang.titleEditImage,r.appendChild(i);const n=document.createElement("div");n.setAttribute("class","galleri-fields"),r.appendChild(n),a.addField(n,"filename",window.GALLERI.lang.fieldImageFilename);const o=a.addField(n,"folder",window.GALLERI.lang.fieldImageFolder,"select");d.addFolderOptions(o,window.GALLERI.currentImage.attributes.folder),a.addField(n,"title",window.GALLERI.lang.fieldImageTitle),Object.keys(window.GALLERI.currentImage.attributes).forEach((e=>{const t=r.querySelector(`#galleri-input-${e}`);t&&Object.prototype.hasOwnProperty.call(window.GALLERI.currentImage.attributes,e)&&t.setAttribute("value",window.GALLERI.currentImage.attributes[e])})),a.modifier("imageEditForm",{addField:a.addField,container:n,form:r}),l.show(r,{append:!0,callback:s.submitEditFormCallback,closeButtonAttributes:{form:"galleri-image-form",type:"submit"},closeButtonText:window.GALLERI.lang.save,showCancel:!0})}static delete(e){const t=e.target.closest("[data-path]").getAttribute("data-path");l.show(a.sprintf(window.GALLERI.lang.confirmDeleteImage,t),{closeButtonText:window.GALLERI.lang.delete,closeButtonClass:"galleri-button--danger",showCancel:!0,callback:()=>{s.deleteCallback(t),l.hide()}})}static deleteCallback(e){i.request({method:"DELETE",url:`${window.GALLERI.args.apiPath}?type=images&id=${e}`,callback:()=>{o.show(window.GALLERI.lang.deletedSuccessfullyImage,{class:"galleri-toast--success"}),s.removeImageFromList(e),a.callback("afterDeleteImage",{id:e})}})}static setThumbnail(e){e.target.getAttribute("data-current-thumbnail")?s.removeThumbnail(e):s.makeThumbnail(e)}static makeThumbnail(e){const t=e.target.closest("[data-path]").getAttribute("data-path"),l=window.GALLERI.currentImages[t],r=window.GALLERI.currentFolder.id,n={id:r,attributes:window.GALLERI.currentFolder.attributes};n.attributes.thumbnail=l.meta.thumbnail,i.request({method:"PUT",url:`${window.GALLERI.args.apiPath}?type=folders&id=${r}`,json:JSON.stringify(n),callback:()=>{o.show(window.GALLERI.lang.updatedSuccessfullyThumbnail,{class:"galleri-toast--success"});const t=document.querySelector("[data-current-thumbnail]");t&&(t.innerText=window.GALLERI.lang.makeThumbnail,t.removeAttribute("data-current-thumbnail")),e.target.innerText=window.GALLERI.lang.removeThumbnail,e.target.setAttribute("data-current-thumbnail",!0),a.callback("afterMakeThumbnail",{folderId:r,image:l})},errorCallback:()=>{o.show(window.GALLERI.lang.errorUpdatingThumbnail,{class:"galleri-toast--error"})}})}static removeThumbnail(e){const t=e.target.closest("[data-path]").getAttribute("data-path"),l=window.GALLERI.currentImages[t],r=window.GALLERI.currentFolder.id,n={id:r,attributes:window.GALLERI.currentFolder.attributes};n.attributes.thumbnail="",i.request({method:"PUT",url:`${window.GALLERI.args.apiPath}?type=folders&id=${r}`,json:JSON.stringify(n),callback:()=>{o.show(window.GALLERI.lang.removedSuccessfullyThumbnail,{class:"galleri-toast--success"}),e.target.innerText=window.GALLERI.lang.makeThumbnail,e.target.removeAttribute("data-current-thumbnail"),a.callback("afterRemoveThumbnail",{folderId:r,image:l})},errorCallback:()=>{o.show(window.GALLERI.lang.errorRemovingThumbnail,{class:"galleri-toast--error"})}})}static submitCreateFormCallback(e){e.preventDefault();const t=document.getElementById("galleri-image-form");n.clear(t);const a=document.getElementById("galleri-input-upload");if(a.files.length<=0)return void n.add(a,window.GALLERI.lang.validationRequired);const l=new FormData(t);i.request({method:t.getAttribute("method"),url:t.getAttribute("action"),formData:l,callback:e=>{s.createRequestCallback(e)},errorCallback:(e,t)=>{n.show(e,t)}})}static createRequestCallback(e){o.show(window.GALLERI.lang.createdSuccessfullyImage,{class:"galleri-toast--success"}),s.prependItems(e.data),window.GALLERI.grid&&window.GALLERI.grid.resizeAllItems(),e.data.forEach((e=>{window.GALLERI.currentImages[e.id]=e})),window.GALLERI.currentNumImages+=e.data.length,a.setNumImages(),document.getElementById("galleri-input-upload").value="",document.getElementById("galleri-create-image-text").innerText=window.GALLERI.lang.dragImagesOrClickHereToUpload;const t=document.getElementById("galleri-delete-folder");t&&(t.style.display="none"),a.callback("afterCreateImage",{image:e.data})}static submitEditFormCallback(e){e.preventDefault();const t=document.getElementById("galleri-image-form");n.clear(t);const a=document.getElementById("galleri-input-filename");if(!a.value)return void n.add(a,window.GALLERI.lang.validationRequired);const r=new FormData(t);let d={},c={};if(r.forEach(((e,t)=>{d[t]=e,Object.prototype.hasOwnProperty.call(window.GALLERI.currentImage.attributes,t)?c[t]=window.GALLERI.currentImage.attributes[t]:c[t]=""})),d=JSON.stringify(d),c=JSON.stringify(c),d===c)return o.show(window.GALLERI.lang.nothingToSave),void l.hide(e);i.request({method:t.getAttribute("method"),url:t.getAttribute("action"),json:d,callback:t=>{s.editRequestCallback(e,t)},errorCallback:(e,t)=>{n.show(e,t)}})}static editRequestCallback(e,t){o.show(window.GALLERI.lang.updatedSuccessfullyImage,{class:"galleri-toast--success"}),document.getElementById("galleri-input-folder").value!==window.GALLERI.currentImage.attributes.folder?s.removeImageFromList(window.GALLERI.currentImage.id):s.updateImage(window.GALLERI.currentImage.id,t.data),delete window.GALLERI.currentImages[window.GALLERI.currentImage.id],window.GALLERI.currentImages[t.data.id]=t.data,window.GALLERI.currentImage=null,l.hide(e),a.callback("afterEditImage",{image:t.data})}static appendItems(e){const t=e.map((e=>s.element(e)));window.GALLERI.elements.$imageList.append(...t)}static prependItems(e){e.forEach((e=>{window.GALLERI.elements.$imageList.prepend(s.element(e,!0))}))}static removeImageFromList(e){const t=document.querySelector(`[data-path="${e}"]`);let l;if(t.nextSibling&&(l=t.nextSibling.querySelector("button")),!l&&t.previousSibling&&(l=t.previousSibling.querySelector("button")),t.remove(),window.GALLERI.currentNumImages-=1,a.setNumImages(),s.hasImages())window.GALLERI.grid&&window.GALLERI.grid.resizeAllItems(),l&&l.focus();else if(!d.hasFolders()){const e=document.getElementById("galleri-delete-folder");e&&(e.style.display="")}}static onChange(e){const t=[...e.target.files].map((e=>e.name));document.getElementById("galleri-create-image-text").innerText=t.join(", ")}static updateImage(e,t){const l=document.querySelector(`[data-path="${e}"]`);l.setAttribute("data-path",t.id),l.querySelector(".galleri-link").setAttribute("href",t.meta.url);const r=l.querySelector(".galleri-img");t.attributes.title?r.setAttribute("alt",t.attributes.title):r.removeAttribute("alt"),a.callback("afterUpdateImage",{image:t,element:l})}static view(e){e.target.closest("[data-path]").querySelector(".galleri-link").click()}static getImages(){return document.querySelectorAll(`#galleri-images > ${window.GALLERI.args.imageItemElement}`)}static hasImages(){return s.getImages().length>0}static addAdminControls(e,t){if(e.querySelector(".galleri-admin"))return;const a=document.createElement("div");a.setAttribute("class","galleri-admin galleri-button-container"),e.appendChild(a);const l=document.createElement("button");l.setAttribute("class","galleri-button"),l.setAttribute("href","button"),l.innerText=window.GALLERI.lang.view,l.addEventListener("click",s.view),a.appendChild(l);const r=document.createElement("button");if(r.setAttribute("class","galleri-button galleri-button--secondary"),r.setAttribute("type","button"),r.innerText=window.GALLERI.lang.edit,r.addEventListener("click",s.showEditForm),a.appendChild(r),t.attributes.folder){const e=document.createElement("button");e.setAttribute("class","galleri-button galleri-button--secondary"),e.setAttribute("href","button"),e.setAttribute("data-thumbnail-button",!0),e.addEventListener("click",s.setThumbnail);const l=window.GALLERI.folders[t.attributes.folder];l&&l.attributes.thumbnail===t.meta.thumbnail?(e.setAttribute("data-current-thumbnail",!0),e.innerText=window.GALLERI.lang.removeThumbnail):e.innerText=window.GALLERI.lang.makeThumbnail,a.appendChild(e)}const i=document.createElement("button");if(i.setAttribute("class","galleri-button galleri-button--danger"),i.setAttribute("type","button"),i.innerText=window.GALLERI.lang.delete,i.addEventListener("click",s.delete),a.appendChild(i),window.GALLERI.args.removePointerEventsOnLogin){const t=e.querySelector(".galleri-link");t.style.pointerEvents="none",t.setAttribute("tabindex",-1)}}static onScroll(){const e=document.querySelectorAll("[data-src]"),t=window.innerHeight,a=window.pageYOffset+t+t;e.forEach((e=>{e.getBoundingClientRect().top<=a&&s.setSrc(e)}))}static setSrc(e){const t=e.getAttribute("data-src");e.setAttribute("src",t),e.removeAttribute("data-src"),e.closest(".galleri-link").style.backgroundImage=`url("${t}")`,a.callback("afterLoadImage",{element:e})}}class c{static init(){window.GALLERI.elements.$authenticateButton&&(window.GALLERI.elements.$authenticateButton.addEventListener("click",(()=>{c.authenticate()})),c.handleAuthentication())}static authenticate(){a.isLoggedIn()?c.logout():c.login()}static logout(){if(window.navigator.userAgent.indexOf("Safari")>-1)return void c.logoutCallback();const e=[window.location.protocol,"//log:out@",window.location.host,`${window.GALLERI.args.apiPath}?type=sessions`].join("");i.request({method:"DELETE",url:e,noParse:!0,callback:()=>{c.logoutCallback()},errorCallback:()=>{c.logoutCallback()}})}static logoutCallback(){window.localStorage.clear(),c.handleLogout()}static login(){i.request({method:"POST",url:`${window.GALLERI.args.apiPath}?type=sessions`,noParse:!0,callback:(e,t)=>{204===t?(window.localStorage.setItem(window.GALLERI.args.localStorageKey,!0),this.handleLogin()):l.show(window.GALLERI.lang.error+window.GALLERI.lang.errorInvalidUsername)}})}static handleAuthentication(){a.isLoggedIn()?c.handleLogin():c.handleLogout()}static handleLogin(){window.GALLERI.elements.$authenticateButton.innerText=window.GALLERI.lang.logOut,document.body.classList.add("galleri-is-admin"),c.addAdminBar(),s.getImages().forEach((e=>{const t=e.getAttribute("data-path");s.addAdminControls(e,window.GALLERI.currentImages[t])})),a.callback("afterLogin")}static handleLogout(){window.GALLERI.elements.$authenticateButton.innerText=window.GALLERI.lang.logIn,document.body.classList.remove("galleri-is-admin");let e=document.querySelectorAll(".galleri-admin");e.forEach((e=>{e.remove()})),window.GALLERI.args.removePointerEventsOnLogin&&(e=document.querySelectorAll(".galleri-link"),e.forEach((e=>{e.removeAttribute("tabindex"),e.style.pointerEvents=""}))),a.callback("afterLogout")}static addAdminBar(){const e=document.createElement("div");e.setAttribute("id","galleri-admin"),e.setAttribute("class","galleri-admin"),window.GALLERI.elements.$container.prepend(e);const t=document.createElement("div");t.setAttribute("class","galleri-button-container"),t.setAttribute("id","galleri-admin-buttons"),e.prepend(t);const l=document.createElement("button");l.setAttribute("class","galleri-button"),l.setAttribute("id","galleri-create-image"),l.setAttribute("type","button"),l.innerText=window.GALLERI.lang.uploadImage,l.addEventListener("click",s.showCreateForm),t.append(l);const r=document.createElement("button");if(r.setAttribute("class","galleri-button galleri-button--secondary"),r.setAttribute("id","galleri-create-folder"),r.setAttribute("type","button"),r.innerText=window.GALLERI.lang.createFolder,r.addEventListener("click",d.showCreateForm),t.append(r),window.GALLERI.currentFolder.id){const e=document.createElement("button");e.setAttribute("class","galleri-button galleri-button--secondary"),e.setAttribute("id","galleri-edit-folder"),e.setAttribute("type","button"),e.innerText=window.GALLERI.lang.editFolder,e.addEventListener("click",d.showEditForm),t.append(e);const l=document.createElement("button");l.setAttribute("class","galleri-button galleri-button--danger"),l.setAttribute("id","galleri-delete-folder"),l.setAttribute("type","button"),l.innerText=window.GALLERI.lang.deleteFolder,a.isEmpty()||(l.style.display="none"),l.addEventListener("click",d.delete),t.append(l)}a.modifier("adminBar",{element:t})}}class u{constructor(){window.GALLERI.elements.$imageList.classList.add("galleri-grid"),this.calculate(),window.addEventListener("resize",a.debounce((()=>{this.calculate(),this.resizeAllItems()}),100))}calculate(){const e=window.getComputedStyle(window.GALLERI.elements.$imageList);this.gridRowHeight=parseInt(e.getPropertyValue("grid-auto-rows"),10),this.gridRowGap=parseInt(e.getPropertyValue("grid-row-gap"),10)}checkResizeItem(e){const t=e.querySelector("img");this.resizeItem(e,t),t.onload=()=>{this.resizeItem(e,t),e.querySelector("a").classList.add("galleri-show")}}resizeItem(e,t){const a=t.getBoundingClientRect().height,l=Math.ceil((a+this.gridRowGap)/(this.gridRowHeight+this.gridRowGap));e.style.gridRowEnd=`span ${l}`}resizeAllItems(){[...document.getElementsByClassName("galleri-figure")].forEach((e=>{this.checkResizeItem(e)}))}}class m{constructor(e){(e=e||{}).apiFoldersPath=e.apiFoldersPath||"/json/folders.json",e.apiImagesPath=e.apiImagesPath||"/json/images.json",e.apiPath=e.apiPath||"/api.php",e.callbacks=e.callbacks||{},e.enableGrid=!a.propertyExists(e,"enableGrid")||e.enableGrid,e.enableRewrites=!a.propertyExists(e,"enableRewrites")||e.enableRewrites,e.folderItemElement=e.folderItemElement||"li",e.folderSeparator=e.folderSeparator||" > ",e.imageItemElement=e.imageItemElement||"figure",e.localStorageKey=e.localStorageKey||"authenticated",e.metaTitleSeparator=e.metaTitleSeparator||" | ",e.modifiers=e.modifiers||{},e.pageSize=e.pageSize||8,e.removePointerEventsOnLogin=!a.propertyExists(e,"removePointerEventsOnLogin")||e.removePointerEventsOnLogin,e.selector=e.selector||"#galleri",e.showAllImages=!!a.propertyExists(e,"showAllImages")&&e.showAllImages,this.args=e;const t=document.querySelector(e.selector);if(!t)return;const l=e.lang||{};l.cancel=l.cancel||"Cancel",l.close=l.close||"Close",l.confirmDeleteFolder=l.confirmDeleteFolder||'Are you sure you want to delete the folder "%s"?',l.confirmDeleteImage=l.confirmDeleteImage||'Are you sure you want to delete the image "%s"?',l.createdSuccessfullyImage=l.createdSuccessfullyImage||"Image uploaded successfully.",l.createdSuccessfullyFolder=l.createdSuccessfullyFolder||"Folder created successfully.",l.createFolder=l.createFolder||"Create Folder",l.delete=l.delete||"Delete",l.deletedSuccessfullyImage=l.deletedSuccessfullyImage||"Image deleted successfully.",l.deletedSuccessfullyFolder=l.deletedSuccessfullyFolder||"Folder deleted successfully.",l.deleteFolder=l.deleteFolder||"Delete Folder",l.dragImagesOrClickHereToUpload=l.dragImagesOrClickHereToUpload||"Drag images or click here to upload.",l.edit=l.edit||"Edit",l.editFolder=l.editFolder||"Edit Folder",l.error=l.error||"Error: ",l.errorFolderDoesNotExist=l.errorFolderDoesNotExist||"This folder does not exist.",l.errorInvalidUsername=l.errorInvalidUsername||"Invalid username or password.",l.errorUpdatingThumbnail=l.errorUpdatingThumbnail||"Error updating thumbnail.",l.errorRemovingThumbnail=l.errorRemovingThumbnail||"Error removing thumbnail.",l.errorStatus=l.errorStatus||"The server returned a %s error.",l.fieldFolderId=l.fieldFolderId||"ID",l.fieldFolderName=l.fieldFolderName||"Name",l.fieldFolderParent=l.fieldFolderParent||"Parent",l.fieldFolderThumbnail=l.fieldFolderThumbnail||"Thumbnail",l.fieldImageImages=l.fieldImageImages||"Images",l.fieldImageFilename=l.fieldImageFilename||"Filename",l.fieldImageTitle=l.fieldImageTitle||"Title",l.fieldImageFolder=l.fieldImageFolder||"Folder",l.home=l.home||"Home",l.loading=l.loading||"Loading...",l.logIn=l.logIn||"Log In",l.logOut=l.logOut||"Log Out",l.makeThumbnail=l.makeThumbnail||"Make Thumbnail",l.nothingToSave=l.nothingToSave||"Nothing to save.",l.ok=l.ok||"OK",l.pluralImageText=l.pluralImageText||"images",l.removeThumbnail=l.removeThumbnail||"Remove Thumbnail",l.removedSuccessfullyThumbnail=l.removedSuccessfullyThumbnail||"Thumbnail removed successfully.",l.save=l.save||"Save",l.singularImageText=l.singularImageText||"image",l.submitCreateFolder=l.submitCreateFolder||"Create",l.submitEditFolder=l.submitEditFolder||"Save",l.titleCreateFolder=l.titleCreateFolder||"Create Folder",l.titleEditFolder=l.titleEditFolder||"Edit Folder",l.titleEditImage=l.titleEditImage||"Edit Image",l.updatedSuccessfullyImage=l.updatedSuccessfullyImage||"Image updated successfully.",l.updatedSuccessfullyFolder=l.updatedSuccessfullyFolder||"Folder updated successfully.",l.updatedSuccessfullyThumbnail=l.updatedSuccessfullyThumbnail||"Thumbnail updated successfully.",l.upload=l.upload||"Upload",l.uploadImage=l.uploadImage||"Upload Image",l.validationRequired=l.validationRequired||"Error: This field is required.",l.view=l.view||"View",this.lang=l;const r=document.createElement("ul");r.setAttribute("id","galleri-folders"),t.appendChild(r);const i=document.createElement("div");i.setAttribute("id","galleri-images"),t.appendChild(i),this.elements={$authenticateButton:document.querySelector('[data-action="authenticate"]'),$container:t,$folderList:r,$imageList:i},this.state={isLoadingFolder:!1,isLoadingImages:!1,numRequestsInProgress:0},this.currentFolder=null,this.currentImage=null,this.currentImages={},this.currentNumImages=null,this.folders=[]}static init(e){if(!a.propertyExists(window,"GALLERI")){if(window.GALLERI=new m(e),!window.GALLERI.elements.$imageList)return null;d.load(),s.load(),e.enableGrid&&(window.GALLERI.grid=new u);let t=setInterval((()=>{window.GALLERI.state.isLoadingFolder||window.GALLERI.state.isLoadingImages||(c.init(),a.setNumImages(),clearInterval(t),t=null)}),250)}return window.GALLERI}}})(),Galleri=t})();